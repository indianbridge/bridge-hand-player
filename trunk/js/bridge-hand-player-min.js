var Bridge={};Bridge.Suits={n:{name:"NT"},s:{name:'<font color="000000">&spades;</font>'},h:{name:'<font color="CB0000">&hearts;</font>'},d:{name:'<font color="CB0000">&diams;</font>'},c:{name:'<font color="000000">&clubs;</font>'}};Bridge.getSuitName=function(e){return Bridge.Suits[e].name};Bridge.CardSuitOrder=["s","h","d","c"];Bridge.checkCardSuit=function(e){if(Bridge.CardSuitOrder.indexOf(e)===-1){throw e+" is not a valid Card Suit!"}};Bridge.BidSuitOrder=["n","s","h","d","c"];Bridge.checkBidSuit=function(e){if(Bridge.BidSuitOrder.indexOf(e)===-1){throw e+" is not a valid Bid Suit!"}};Bridge.Ranks={a:{name:"A",index:0},k:{name:"K",index:1},q:{name:"Q",index:2},j:{name:"J",index:3},t:{name:"T",index:4},9:{name:"9",index:5},8:{name:"8",index:6},7:{name:"7",index:7},6:{name:"6",index:8},5:{name:"5",index:9},4:{name:"4",index:10},3:{name:"3",index:11},2:{name:"2",index:12}};Bridge.getRankName=function(e){return Bridge.Ranks[e].name};Bridge.RankOrder=["a","k","q","j","t","9","8","7","6","5","4","3","2"];Bridge.checkRank=function(e){if(!(e in Bridge.Ranks)){throw e+" is not a valid Rank!"}return true};Bridge.isGreaterRank=function(e,t){var n=Bridge.RankOrder.indexOf(e);var r=Bridge.RankOrder.indexOf(t);return n<r};Bridge.Directions={n:{name:"North",layout:"horizontal",position:"top",lho:"e",rho:"w"},e:{name:"East",layout:"vertical",position:"right",lho:"s",rho:"n"},s:{name:"South",layout:"horizontal",position:"bottom",lho:"w",rho:"e"},w:{name:"West",layout:"vertical",position:"left",lho:"n",rho:"s"}};Bridge.getDirectionName=function(e){return Bridge.Directions[e].name};Bridge.DirectionOrder=["n","e","s","w"];Bridge.checkDirection=function(e){var t=arguments.callee.caller.name;if(!(e in Bridge.Directions)){throw"In "+t+" "+e+" is not a valid direction!"}return true};Bridge.areOppositeDirections=function(e,t){return(e==="n"||e==="s")&&(t==="e"||t==="w")||(e==="e"||e==="w")&&(t==="n"||t==="s")};Bridge.checkLevel=function(e){if(isNaN(e)||e<1||e>7){throw e+" is a not a valid bidding level!"}};Bridge.checkVulnerability=function(e){if(!(e in Bridge.Vulnerability)){throw e+" is not a valid Vulnerability!"}};Bridge.getLHO=function(e){Bridge.checkDirection(e);return Bridge.Directions[e].lho};Bridge.getRHO=function(e){Bridge.checkDirection(e);return Bridge.Directions[e].rho};Bridge.Vulnerability={"-":{name:"None"},n:{name:"North-South"},e:{name:"East-West"},b:{name:"Both"}};Bridge.Card=function(e,t,n){Bridge.checkCardSuit(e);this.suit=e;Bridge.checkRank(t);this.rank=t;if(n===undefined){this.direction=null}else{Bridge.checkDirection(n);this.direction=n}this.played=false};Bridge.Card.prototype.play=function(){if(this.played)throw Bridge.getSuitName(this.suit)+Bridge.getRankName(this.rank)+" has already been played!";this.played=true};Bridge.Card.prototype.reset=function(){this.played=false};Bridge.Card.prototype.undo=function(){if(!this.played)throw Bridge.getSuitName(this.suit)+Bridge.getRankName(this.rank)+" has not been played!";this.played=false};Bridge.Card.prototype.getDirection=function(){return this.direction};Bridge.Card.prototype.setDirection=function(e){this.direction=e};Bridge.Cards={};for(var i=0;i<Bridge.CardSuitOrder.length;++i){var suit=Bridge.CardSuitOrder[i];Bridge.Cards[suit]={};for(var rank in Bridge.Ranks){Bridge.Cards[suit][rank]=new Bridge.Card(suit,rank)}}Bridge.Cards.reset=function(){for(var e=0;e<Bridge.CardSuitOrder.length;++e){var t=Bridge.CardSuitOrder[e];for(var n in Bridge.Ranks){Bridge.Cards[t][n].reset()}}};Bridge.PlayedCard=function(e,t,n,r){if(r===undefined)r=null;Bridge.checkCardSuit(e);Bridge.checkRank(t);Bridge.checkDirection(n);this.suit=e;this.rank=t;this.direction=n;this.annotation=r;this.nextPlayedCard=null;this.previousPlayedCard=null;this.playNumber=0;this.trickWinner=null;this.ledCard=null;this.ewTricks=0;this.nsTricks=0};Bridge.PlayedCard.prototype.winTrick=function(e){if(this.playNumber%4===1)return true;var t=this.getTrickWinner();var n=t.getSuit();var r=t.getRank();if(this.suit!==e){if(n===e)return false;else if(this.suit===n&&Bridge.isGreaterRank(this.rank,r))return true;return false}else{if(n!==e||Bridge.isGreaterRank(this.rank,r))return true;return false}return false};Bridge.PlayedCard.prototype.getNextToPlay=function(){if(this.playNumber%4===0){return this.trickWinner.direction}else return Bridge.getLHO(this.direction)};Bridge.PlayedCard.prototype.getSuitLed=function(){if(this.playNumber%4==0)return null;else{play=this;while(play.getPlayNumber()%4!==1)play=play.getPreviousCard();return play.getSuit()}};Bridge.PlayedCard.prototype.setNSTricks=function(e){this.nsTricks=e};Bridge.PlayedCard.prototype.setEWTricks=function(e){this.ewTricks=e};Bridge.PlayedCard.prototype.getNSTricks=function(){return this.nsTricks};Bridge.PlayedCard.prototype.getEWTricks=function(){return this.ewTricks};Bridge.PlayedCard.prototype.incrementNSTricks=function(){this.nsTricks++};Bridge.PlayedCard.prototype.incrementEWTricks=function(){this.ewTricks++};Bridge.PlayedCard.prototype.getAnnotation=function(){return this.annotation};Bridge.PlayedCard.prototype.setAnnotation=function(e){this.annotation=e};Bridge.PlayedCard.prototype.getDirection=function(){return this.direction};Bridge.PlayedCard.prototype.setDirection=function(e){this.direction=e};Bridge.PlayedCard.prototype.getTrickWinner=function(){return this.trickWinner};Bridge.PlayedCard.prototype.setTrickWinner=function(e){this.trickWinner=e};Bridge.PlayedCard.prototype.getPlayNumber=function(){return this.playNumber};Bridge.PlayedCard.prototype.setPlayNumber=function(e){this.playNumber=e};Bridge.PlayedCard.prototype.getPreviousCard=function(){return this.previousPlayedCard};Bridge.PlayedCard.prototype.getNextCard=function(){return this.nextPlayedCard};Bridge.PlayedCard.prototype.getSuit=function(){return this.suit};Bridge.PlayedCard.prototype.getRank=function(){return this.rank};Bridge.PlayedCard.prototype.setNextCard=function(e){this.nextPlayedCard=e};Bridge.PlayedCard.prototype.setPreviousCard=function(e){this.previousPlayedCard=e};Bridge.Bid=function(e,t,n,r){if(r===undefined)r=null;if(t==="p"||t==="x"||t==="r"){this.suit=t}else{Bridge.checkBidSuit(t);this.suit=t;Bridge.checkLevel(e);this.level=e}Bridge.checkDirection(n);this.direction=n;this.annotation=r;this.previousBid=null;this.nextBid=null};Bridge.Bid.prototype.getString=function(){var e="";if(this.suit==="x")e='<font color="red">X</font>';else if(this.suit==="r")e='<font color="blue">XX<font>';else if(this.suit==="p")e='<font color="green">P</font>';else if(this.suit in Bridge.Suits){e=this.level+Bridge.getSuitName(this.suit)}else e="Unknown";return{bid:e,annotation:this.annotation}};Bridge.Bid.prototype.getLevel=function(){return this.level};Bridge.Bid.prototype.getSuit=function(){return this.suit};Bridge.Bid.prototype.getDirection=function(){return this.direction};Bridge.Bid.prototype.getAnnotation=function(){return this.annotation};Bridge.Bid.prototype.getNextBid=function(e){return this.nextBid};Bridge.Bid.prototype.setNextBid=function(e){this.nextBid=e};Bridge.Bid.prototype.getPreviousBid=function(e){return this.previousBid};Bridge.Bid.prototype.setPreviousBid=function(e){this.previousBid=e};Bridge.Bid.prototype.countPasses=function(){var e=this;var t=0;if(e.getSuit()==="p")t++;while(e.getSuit()==="p"&&e.getPreviousBid()!==null){e=e.getPreviousBid();if(e.getSuit()==="p")t++}return t};Bridge.Hand=function(e){this.cards={};this.name=null;this.direction=e;this.numCards=0;for(var t=0;t<Bridge.CardSuitOrder.length;++t){var n=Bridge.CardSuitOrder[t];this.cards[n]={}}};Bridge.Hand.prototype.hasCard=function(e,t){if(!(e in this.cards)){return false}if(!(t in this.cards[e]))return false;return true};Bridge.Hand.prototype.setName=function(e){this.name=e};Bridge.Hand.prototype.getName=function(){return this.name};Bridge.Hand.prototype.getNumCards=function(){return this.numCards};Bridge.Hand.prototype.addCard=function(e,t){Bridge.checkCardSuit(e);Bridge.checkRank(t);this.cards[e][t]=Bridge.Cards[e][t];this.numCards++};Bridge.Hand.prototype.removeCard=function(e,t){Bridge.checkSuit(e);Bridge.checkRank(t);if(this.cards[e][t]===undefined){throw"In Bridge.Hand.removeCard "+Bridge.getSuitName(e)+Bridge.getRankName(t)+" is not found!"}delete this.cards[e][t];this.numCards--};Bridge.Deal=function(){this.hands={};for(var e in Bridge.Directions){this.hands[e]=new Bridge.Hand(e)}this.firstBid=null;this.lastBid=null;this.currentLevels={level:0,suit:"",direction:"",doubled:false,redoubled:false};this.board=null;this.dealer="n";this.vulnerability="-";this.trumpSuit=null;this.leader=null;this.contract=null;this.notes=null;this.firstPlayedCard=null;this.lastPlayedCard=null;this.currentPlayedCard=null;this.savedPlays={};this.loadedPlay=null};Bridge.Deal.prototype.isAtBeginning=function(){return this.currentPlayedCard===null};Bridge.Deal.prototype.isAtEnd=function(){return this.currentPlayedCard===this.lastPlayedCard};Bridge.Deal.prototype.isValidPlayNumber=function(e){if(isNaN(e)||e<0)return false;if(this.lastPlayedCard===null){return e===0}else{return e<=this.lastPlayedCard.getPlayNumber()}};Bridge.Deal.prototype.getPlayNumber=function(){if(this.currentPlayedCard===null)return 0;else return this.currentPlayedCard.getPlayNumber()};Bridge.Deal.prototype.isAtPlayNumber=function(e){if(this.currentPlayedCard===null)return false;else return this.currentPlayedCard.getPlayNumber()===e};Bridge.Deal.prototype.isNewTrick=function(){if(this.currentPlayedCard===null||this.currentPlayedCard.getPlayNumber()%4===1)return true;return false};Bridge.Deal.prototype.isEndOfTrick=function(){if(this.currentPlayedCard===null||this.currentPlayedCard.getPlayNumber()%4===0)return true;return false};Bridge.Deal.prototype.getTableCards=function(){var e=this.currentPlayedCard;var t=[];if(e===null)return t;t.push({suit:e.getSuit(),rank:e.getRank()});e=e.getPreviousCard();while(e!==null&&e.getPlayNumber()%4!==0){t.push({suit:e.getSuit(),rank:e.getRank()});e=e.getPreviousCard()}return t};Bridge.Deal.prototype.playCard=function(e,t,n,r){if(n===undefined||n===null){if(this.currentPlayedCard===null){n=this.leader}else{n=this.currentPlayedCard.getNextToPlay()}}if(r===undefined)r=null;var i=new Bridge.PlayedCard(e,t,n,r);if(!this.hands[n].hasCard(e,t)){throw Bridge.getDirectionName(n)+" does not have "+Bridge.getSuitName(e)+Bridge.getRankName(t)+"!"}if(this.currentPlayedCard!==null){this.currentPlayedCard.setNextCard(i);i.setPlayNumber(this.currentPlayedCard.getPlayNumber()+1);i.setPreviousCard(this.currentPlayedCard);this.lastPlayedCard=i;i.setTrickWinner(this.currentPlayedCard.getTrickWinner());if(i.winTrick(this.trumpSuit)){i.setTrickWinner(i)}i.setEWTricks(this.currentPlayedCard.getEWTricks());i.setNSTricks(this.currentPlayedCard.getNSTricks())}else{this.firstPlayedCard=i;this.lastPlayedCard=i;i.setPlayNumber(1);i.setTrickWinner(i)}this.currentPlayedCard=i;if(this.currentPlayedCard.getPlayNumber()%4===0){var s=this.currentPlayedCard.getTrickWinner().getDirection();if(s==="n"||s==="s")this.currentPlayedCard.incrementNSTricks();else this.currentPlayedCard.incrementEWTricks()}this.loadedPlay=null;Bridge.Cards[e][t].play()};Bridge.Deal.prototype.setAnnotationForCard=function(e,t,n){var r=this.firstPlayedCard;while(r!==null){if(r.getSuit()===e&&r.getRank()===t){r.setAnnotation(n);return}r=r.getNextCard()}throw"Card "+e+t+" was not found when trying to add annotation!"};Bridge.Deal.prototype.getAnnotationForCard=function(e,t){var n=this.firstPlayedCard;while(n!==null){if(n.getSuit()===e&&n.getRank()===t){return n.getAnnotation()}n=n.getNextCard()}throw"Card "+e+t+" was not found when trying to add annotation!"};Bridge.Deal.prototype.resetPlayedCardIndex=function(){this.currentPlayedCard=null;Bridge.Cards.reset()};Bridge.Deal.prototype.resetAll=function(){this.currentPlayedCard=null;this.firstPlayedCard=null;this.lastPlayedCard=null;Bridge.Cards.reset()};Bridge.Deal.prototype.savePlay=function(e){if(e in this.savedPlays){throw"There is already a saved play with name "+e+". Please use a different name."}var t=0;if(this.currentPlayedCard!==null)t=this.currentPlayedCard.getPlayNumber();this.savedPlays[e]={firstPlayedCard:this.firstPlayedCard,currentPlayNumber:t,lastPlayedCard:this.lastPlayedCard};this.loadedPlay=e};Bridge.Deal.prototype.getSavedPlayNumber=function(){return this.savedPlays.length};Bridge.Deal.prototype.getSavedPlayNames=function(){var e=[];for(var t in this.savedPlays)e.push(t);return e};Bridge.Deal.prototype.loadPlay=function(e){if(!(e in this.savedPlays)){alert(e+" is not a valid saved line of play!");return null}var t=this.savedPlays[e];this.firstPlayedCard=t.firstPlayedCard;this.lastPlayedCard=t.lastPlayedCard;this.loadedPlay=e;return t.currentPlayNumber};Bridge.Deal.prototype.undoCard=function(){if(this.currentPlayedCard===null){return null}else{var e={suit:this.currentPlayedCard.getSuit(),rank:this.currentPlayedCard.getRank(),direction:this.currentPlayedCard.getDirection()};this.currentPlayedCard=this.currentPlayedCard.getPreviousCard();Bridge.Cards[e.suit][e.rank].undo();return e}};Bridge.Deal.prototype.redoCard=function(){if(this.currentPlayedCard===null){if(this.firstPlayedCard===null){return null}else this.currentPlayedCard=this.firstPlayedCard}else{var e=this.currentPlayedCard.getNextCard();if(e===null){return null}else{this.currentPlayedCard=e}}var t={suit:this.currentPlayedCard.getSuit(),rank:this.currentPlayedCard.getRank(),direction:this.currentPlayedCard.getDirection()};Bridge.Cards[t.suit][t.rank].play();return t};Bridge.Deal.prototype.getNextToPlay=function(){if(this.currentPlayedCard!==null)return this.currentPlayedCard.getNextToPlay();else return this.leader};Bridge.Deal.prototype.getSuitLed=function(){if(this.currentPlayedCard!==null)return this.currentPlayedCard.getSuitLed();else return null};Bridge.Deal.prototype.determineDeclarer=function(){var e={level:0,suit:"",doubled:false,redoubled:false,declarer:""};var t=this.numPasses();if(t!==3){throw"Auction ends with "+t+" passes instead of 3 passes!"}var n=this.lastBid;while(n!==null&&n.getSuit()==="p"){n=n.getPreviousBid()}if(n===null){throw"Unable to determine declarer!"}if(n.getSuit()==="r"){e.redoubled=true;n=n.getPreviousBid()}while(n!==null&&n.getSuit()==="p"){n=n.getPreviousBid()}if(n===null){throw"Unable to determine declarer!"}if(n.getSuit()==="x"){if(!e.redoubled)e.doubled=true;n=n.getPreviousBid()}if(n===null){throw"Unable to determine declarer!"}while(n!==null&&n.getSuit()==="p"){n=n.getPreviousBid()}if(n===null){throw"Unable to determine declarer!"}e.suit=n.getSuit();e.level=n.getLevel();var r=n.getDirection();n=n.getPreviousBid();while(n!==null){var i=n.getDirection();var s=n.getSuit();if(s===e.suit&&!Bridge.areOppositeDirections(i,r)){r=i}n=n.getPreviousBid()}e.declarer=r;this.setContract(e.level,e.suit,e.declarer,e.doubled,e.redoubled)};Bridge.Deal.prototype.numPasses=function(){var e=0;var t=this.lastBid;while(t!==null&&t.getSuit()==="p"){t=t.getPreviousBid();e++}return e};Bridge.Deal.prototype.addBid=function(e,t,n){var r=this.dealer;if(this.lastBid!==null){r=Bridge.getLHO(this.lastBid.getDirection())}if(t==="r"&&(this.currentLevels.suits===""||!this.currentLevels.doubled||!Bridge.areOppositeDirections(r,this.currentLevels.direction))){throw"Invalid Redouble!";return}if(t==="x"&&(this.currentLevels.suits===""||this.currentLevels.doubled||this.currentLevels.redoubled||!Bridge.areOppositeDirections(r,this.currentLevels.direction))){throw"Invalid Double!";return}if(t==="p"&&this.lastBid!==null&&this.lastBid.countPasses()>2){throw"Invalid Pass!"}if(t!=="p"&&t!=="x"&&t!=="r"){if(this.currentLevels!==null){if(e<this.currentLevels.level||e===this.currentLevels.level&&Bridge.BidSuitOrder.indexOf(t)>Bridge.BidSuitOrder.indexOf(this.currentLevels.suit)){throw"Invalid Bid "+e+t+"!"}}}var i=new Bridge.Bid(e,t,r,n);if(t==="x"){this.currentLevels.doubled=true;this.currentLevels.redoubled=false;this.currentLevels.direction=r}else if(t==="r"){this.currentLevels.doubled=false;this.currentLevels.redoubled=true;this.currentLevels.direction=r}else if(t!=="p"){this.currentLevels.doubled=false;this.currentLevels.redoubled=false;this.currentLevels.direction=r;this.currentLevels.level=e;this.currentLevels.suit=t}if(this.firstBid===null){this.firstBid=i;this.lastBid=i}else{this.lastBid.setNextBid(i);i.setPreviousBid(this.lastBid);this.lastBid=i}};Bridge.Deal.prototype.setBoard=function(e){this.board=e};Bridge.Deal.prototype.getBoard=function(){return this.board};Bridge.Deal.prototype.setDealer=function(e){Bridge.checkDirection(e);this.dealer=e};Bridge.Deal.prototype.getDealer=function(){return this.dealer};Bridge.Deal.prototype.setVulnerability=function(e){Bridge.checkVulnerability(e);this.vulnerability=e};Bridge.Deal.prototype.getVulnerability=function(){return this.vulnerability};Bridge.Deal.prototype.setNotes=function(e){this.notes=e};Bridge.Deal.prototype.getNotes=function(){return this.notes};Bridge.Deal.prototype.setTrumpSuit=function(e){Bridge.checkBidSuit(e);this.trumpSuit=e};Bridge.Deal.prototype.setLeader=function(e){Bridge.checkDirection(e);this.leader=e};Bridge.Deal.prototype.setContract=function(e,t,n,r,i){Bridge.checkLevel(e);Bridge.checkBidSuit(t);Bridge.checkDirection(n);this.contract={level:e,trumpSuit:t,declarer:n,doubled:r,redoubled:i};this.setTrumpSuit(t);this.setLeader(Bridge.getLHO(n))};Bridge.Deal.prototype.getContract=function(){var e=this.contract.level+Bridge.getSuitName(this.contract.trumpSuit);if(this.contract.redoubled)e+='<font color="blue">XX<font>';else if(this.contract.doubled)e+='<font color="red">X</font>';return e};Bridge.Deal.prototype.getDeclarer=function(){return Bridge.getDirectionName(this.contract.declarer)};Bridge.Deal.prototype.addCard=function(e,t,n){Bridge.checkCardSuit(e);Bridge.checkRank(t);Bridge.checkDirection(n);var r=Bridge.Cards[e][t];var i=r.getDirection();if(i!==null){throw"In Bridge.Deal.addCard "+Bridge.getSuitName(e)+Bridge.getRankName(t)+" is already assigned to "+Bridge.getDirectionName(i)+"!"}this.hands[n].addCard(e,t);r.setDirection(n)};Bridge.Deal.prototype.getPlayStrings=function(e){var t="";if(e===undefined)e=false;if(!e||this.loadedPlay===null){if(this.firstPlayedCard===null)return"";var t="&p=";var n=this.firstPlayedCard;while(n!==null){t+=n.getSuit()+n.getRank();var r=n.getAnnotation();if(r!==null)t+="{"+r+"}";n=n.getNextCard()}}if(e){for(var i in this.savedPlays){t+="&p"+i+"=";var n=this.savedPlays[i].firstPlayedCard;while(n!==null){t+=n.getSuit()+n.getRank();var r=n.getAnnotation();if(r!==null)t+="{"+r+"}";n=n.getNextCard()}}}return t};Bridge.Deal.prototype.removeCard=function(e,t){var n=Bridge.Cards[e][t];var r=n.getDirection();if(r===null){throw"In Bridge.Deal.addCard "+Bridge.getSuitName(e)+Bridge.getRankName(t)+" is not assigned to anyone!"}this.hands[r].removeCard(e,t);n.setDirection(null)};Bridge.Deal.prototype.getHand=function(e){Bridge.checkDirection(e);return this.hands[e]};Bridge.Deal.prototype.setName=function(e,t){Bridge.checkDirection(t);this.hands[t].setName(e)};Bridge.Deal.prototype.getNSTricks=function(){if(this.currentPlayedCard===null)return 0;else return this.currentPlayedCard.getNSTricks()};Bridge.Deal.prototype.getEWTricks=function(){if(this.currentPlayedCard===null)return 0;else return this.currentPlayedCard.getEWTricks()};Bridge.Deal.prototype.getName=function(e){Bridge.checkDirection(e);return this.hands[e].getName()};Bridge.Deal.prototype.assignRest=function(){for(var e=0;e<Bridge.CardSuitOrder.length;++e){var t=Bridge.CardSuitOrder[e];for(var n in Bridge.Ranks){var r=Bridge.Cards[t][n];if(r.getDirection()===null){for(var i in Bridge.Directions){if(this.hands[i].getNumCards()<13){this.addCard(t,n,i);break}}}}}};Bridge.Deal.prototype.assignFourthHand=function(e){Bridge.checkDirection(e);for(var t=0;t<Bridge.CardSuitOrder.length;++t){var n=Bridge.CardSuitOrder[t];for(var r in Bridge.Ranks){var i=Bridge.Cards[n][r];if(i.getDirection()===null){this.addCard(n,r,e)}}}};Bridge.Deal.prototype.getNumCards=function(e){return this.hands[e].getNumCards()};Bridge.Deal.prototype.getAuction=function(){var e=[];var t=this.firstBid;while(t!==null){e.push(t);t=t.getNextBid()}return e};Bridge.Deal.prototype.getAnnotation=function(){if(this.currentPlayedCard===null)return"";var e=this.currentPlayedCard.getAnnotation();return e===null?"":unescape(e)};(function(e){if(typeof define==="function"&&define.amd){define(["jquery"],e)}else if(typeof exports==="object"){e(require("jquery"))}else{e(jQuery)}})(function(e){function n(e){return u.raw?e:encodeURIComponent(e)}function r(e){return u.raw?e:decodeURIComponent(e)}function i(e){return n(u.json?JSON.stringify(e):String(e))}function s(e){if(e.indexOf('"')===0){e=e.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\")}try{e=decodeURIComponent(e.replace(t," "));return u.json?JSON.parse(e):e}catch(n){}}function o(t,n){var r=u.raw?t:s(t);return e.isFunction(n)?n(r):r}var t=/\+/g;var u=e.cookie=function(t,s,a){if(s!==undefined&&!e.isFunction(s)){a=e.extend({},u.defaults,a);if(typeof a.expires==="number"){var f=a.expires,l=a.expires=new Date;l.setTime(+l+f*864e5)}return document.cookie=[n(t),"=",i(s),a.expires?"; expires="+a.expires.toUTCString():"",a.path?"; path="+a.path:"",a.domain?"; domain="+a.domain:"",a.secure?"; secure":""].join("")}var c=t?undefined:{};var h=document.cookie?document.cookie.split("; "):[];for(var p=0,d=h.length;p<d;p++){var v=h[p].split("=");var m=r(v.shift());var g=v.join("=");if(t&&t===m){c=o(g,s);break}if(!t&&(g=o(g))!==undefined){c[m]=g}}return c};u.defaults={};e.removeCookie=function(t,n){if(e.cookie(t)===undefined){return false}e.cookie(t,"",e.extend({},n,{expires:-1}));return!e.cookie(t)}});jQuery.browser={};(function(){jQuery.browser.msie=false;jQuery.browser.version=0;if(navigator.userAgent.match(/MSIE ([0-9]+)\./)){jQuery.browser.msie=true;jQuery.browser.version=RegExp.$1}})();(function(e,t,n){function f(e){e=e||location.href;return"#"+e.replace(/^[^#]*#?(.*)$/,"$1")}var r="hashchange",i=document,s,o=e.event.special,u=i.documentMode,a="on"+r in t&&(u===n||u>7);e.fn[r]=function(e){return e?this.bind(r,e):this.trigger(r)};e.fn[r].delay=50;o[r]=e.extend(o[r],{setup:function(){if(a){return false}e(s.start)},teardown:function(){if(a){return false}e(s.stop)}});s=function(){function m(){var n=f(),i=v(u);if(n!==u){p(u=n,i);e(t).trigger(r)}else{if(i!==u){location.href=location.href.replace(/#.*/,"")+i}}o=setTimeout(m,e.fn[r].delay)}var s={},o,u=f(),l=function(e){return e},p=l,v=l;s.start=function(){o||m()};s.stop=function(){o&&clearTimeout(o);o=n};e.browser.msie&&!a&&function(){var t,n;s.start=function(){if(!t){n=e.fn[r].src;n=n&&n+f();t=e('<iframe tabindex="-1" title="empty"/>').hide().one("load",function(){n||p(f());m()}).attr("src",n||"javascript:0").insertAfter("body")[0].contentWindow;i.onpropertychange=function(){try{if(event.propertyName==="title"){t.document.title=i.title}}catch(e){}}}};s.stop=l;v=function(){return f(t.location.href)};p=function(n,s){var o=t.document,u=e.fn[r].domain;if(n!==s){o.title=i.title;o.open();u&&o.write('<script>document.domain="'+u+'"</script>');o.close();t.location.hash=n}}}();return s}()})(jQuery,this);var BHP={};BHP.cardImageDimensions={folder:"images/cards/small",width:76,height:92,cardBackImage:"images/cards/small/b1fv.png",percentageWidthShowing:.5,percentageHeightShowing:.5};BHP.BootstrapClass="success";BHP.bootswatchThemes={};BHP.gutter=5;BHP.fontSize=12;BHP.manualHashChange=true;BHP.savePlayCount=0;BHP.readQueryParameters=function(){BHP.queryParameters=null;var e,t;var n=document.URL.split("?")[1];if(n!==undefined){e=[];n=n.split("#")[0];n=n.trim();if(n){n=n.split("&");for(var r=0;r<n.length;r++){t=n[r].split("=");e.push(t[1]);e[t[0]]=t[1]}}}BHP.queryParameters=e};BHP.getParameterValue=function(e,t){if(e[t]!==undefined){return e[t]}else if(e[t.toUpperCase()]!==undefined){return e[t.toUpperCase()]}return null};BHP.loadDealInformation=function(){var e=BHP.getParameterValue(BHP.queryParameters,"b");if(e){BHP.deal.setBoard(e)}var t=BHP.getParameterValue(BHP.queryParameters,"d");if(t){try{BHP.deal.setDealer(t)}catch(n){BHP.addError(n)}}var r=BHP.getParameterValue(BHP.queryParameters,"v");if(r){try{BHP.deal.setVulnerability(r)}catch(n){BHP.addError(n)}}var i=BHP.getParameterValue(BHP.queryParameters,"t");if(i){try{BHP.deal.setNotes(i)}catch(n){BHP.addError(n)}}};BHP.loadNames=function(){for(var e in Bridge.Directions){var t=e+"n";var n=BHP.getParameterValue(BHP.queryParameters,t);if(n)BHP.deal.setName(n,e)}};BHP.loadHands=function(){var e=[];for(var t in Bridge.Directions){var n=BHP.getParameterValue(BHP.queryParameters,t);if(n){BHP.loadHand(t,n)}else{e.push(t)}}if(e.length===1){BHP.deal.assignFourthHand(e[0]);for(var t in Bridge.Directions){var r=BHP.deal.getNumCards(t);if(r!==13){BHP.addError(Bridge.getDirectionName(t)+" has "+r+"!")}}}else if(e.length>1){var i=[];for(var s=0;s<e.length;++s)i.push(Bridge.getDirectionName(e[s]));var o=i.join(" and ");o+=" hands have not been specified!";BHP.addError(o)}};BHP.loadHand=function(e,t){t=t.toLowerCase();var n=Bridge.getDirectionName(e);var r="";var i="";for(var s=0;s<t.length;++s){var o="In hand for "+n+" at position "+(s+1)+" - ";var u=t.charAt(s);switch(u){case"c":case"d":case"h":case"s":r=u;break;case"1":if(r===""){BHP.addError(o+u+" was found when a suit was expected!");continue}if(s<t.length-1&&t.charAt(s+1)==="0"){i="t";s++}else{BHP.addError(o+"a 1 is present without a subsequent 0. Use 10 or t to reprensent the ten.");continue};default:if(r===""){BHP.addError(o+u+" was found when a suit was expected!");continue}i=u;try{BHP.deal.addCard(r,i,e)}catch(a){BHP.addError(a)}break}}};BHP.loadContract=function(e){BHP.contractString=e;var t=parseInt(e.charAt(1));if(isNaN(t)){var n=e.charAt(1);var r=false;var i=false;var s=e.charAt(2);if(s==="d"||s==="x"||s==="r"){i=s==="r";r=!i;s=e.charAt(3)}var o=Bridge.getRHO(s);try{BHP.deal.setContract(1,n,o,r,i)}catch(u){BHP.addError(u)}}else{var n=e.charAt(2);var o=e.charAt(3);var r=false;var i=false;if(o==="d"||o==="x"||o==="r"){i=o==="r";r=!i;o=e.charAt(4)}try{BHP.deal.setContract(t,n,o,r,i)}catch(u){BHP.addError(u)}}};BHP.parseAnnotation=function(e,t){var n=e.indexOf("}",t+1);if(n===-1){return null}var r=e.slice(t+1,n);return{annotation:r,endBracePosition:n}};BHP.loadAuction=function(){var e="a";var t=BHP.getParameterValue(BHP.queryParameters,e);if(!t){BHP.addError("No auction or contract or trumps and leader has been specified!");return}var n=t;t=t.toLowerCase();if(t.charAt(0)!=="-"){for(var r=0;r<t.length;++r){var i="In auction specified at position "+(r+1)+" - ";var s=t.charAt(r);var o=1;var u="";var a=null;if(s==="{"){var f=t.indexOf("}",r+1);if(f===-1){this.addError(i+" No closing } found!");return}if(bid!==null)bid.annotation=n.slice(r+1,f);r=f;continue}else if(s==="d"||s==="x"){u="x"}else if(s==="p"||s==="r"){u=s}else{o=parseInt(s);r++;u=t.charAt(r)}if(t.charAt(r+1)==="{"){var l=BHP.parseAnnotation(n,r+1);if(!l){BHP.addError(i+" No closing } found!");return}a=l.annotation;r=l.endBracePosition}try{BHP.deal.addBid(o,u,a)}catch(c){BHP.addError(c);return}}try{var h=BHP.deal.determineDeclarer()}catch(c){BHP.addError(c);return}}else{BHP.loadContract(t)}};BHP.drawAuction=function(){var e=BHP.deal.getAuction();if(e.length>0){var t="auction-table";var n='<table id="'+t+'" class="table table-bordered table-condensed table-striped">';n+="<tbody>";n+='<tr class="'+BHP.BootstrapClass+'"><th class="text-center">W</th><th class="text-center">N</th><th class="text-center">E</th><th class="text-center">S</th></tr>';var r=e[0];var i="w";n+='<tr class="text-center">';var s=0;while(r.direction!==i){n+="<td>-</td>";s++;if(i==="s")n+="</tr>";i=Bridge.getLHO(i)}for(var o=0;o<e.length;++o){var u=e[o];if(u.direction!==i){alert("Something went wrong in setting up auction!");return}if(u.direction==="w")n+='<tr class="text-center">';var a=u.getString();var f="";if(a.annotation===null){f=a.bid}else{f='<span data-toggle="tooltip" class="bg-'+BHP.BootstrapClass+' bid-annotation" title="'+unescape(a.annotation)+'">'+a.bid+"</span>"}n+="<td>"+f+"</td>";if(i==="s")n+="</tr>";i=Bridge.getLHO(i)}while(i!=="w"){n+="<td></td>";if(i==="s")n+="</tr>";i=Bridge.getLHO(i)}n+="</tbody></table>";var l="#auction";$(l).empty().append(n)}$(".bid-annotation").tooltip({placement:"bottom"})};BHP.drawDealInformation=function(){var e=BHP.deal.getVulnerability();var t=$("#compass-area");if(e==="n"||e==="b"){t.addClass("ns-vulnerable")}if(e==="e"||e==="b"){t.addClass("ew-vulnerable")}var n=$("#playing-table");var r=BHP.deal.getBoard();if(r===null)r=1;html='<span id="board" class="text-size fixed label label-'+BHP.BootstrapClass+'">Board : '+r+"</span>";n.append(html);var r=$("#board");r.css({top:n.position().top,left:n.position().left});var i=BHP.deal.getContract();var s=BHP.deal.getDeclarer();if(s!==null)i+=" by "+s;html='<span id="contract" class="text-size fixed label label-'+BHP.BootstrapClass+'">Contract : '+i+"</span>";n.append(html);var o=$("#contract");o.css({top:n.position().top,left:n.position().left+n.outerWidth()-o.outerWidth()});html='<span id="ns-tricks" class="text-size fixed label label-'+BHP.BootstrapClass+'">NS Tricks : 0</span>';n.append(html);var u=$("#ns-tricks");u.css({top:n.position().top+n.outerHeight()-u.outerHeight(),left:n.position().left});html='<span id="ew-tricks" class="text-size fixed label label-'+BHP.BootstrapClass+'">EW Tricks : 0</span>';n.append(html);var a=$("#ew-tricks");a.css({top:n.position().top+n.outerHeight()-a.outerHeight(),left:n.position().left+n.outerWidth()-a.outerWidth()});var f=BHP.deal.getNotes();if(f!==null){var l=$("#general-messages");l.empty().append(unescape(f));l.addClass("alert");l.addClass("alert-"+BHP.BootstrapClass)}};BHP.addError=function(e){BHP.errors.push(e)};BHP.showErrors=function(){var e="#section";$(e).addClass("padding-top");var t='<div class="container"><h1>Errors Found as noted below</h1>';t+='<ol class="list-group"><li class="list-group-item list-group-item-warning"><span class="item">';t+=BHP.errors.join('</span></li><li class="list-group-item list-group-item-warning"><span class="item">');t+="</span></li></ol>";t+="</div>";$(e).empty().append(t);t='<div id="postamble"></div>';$(e).append(t);$("#postamble").load("instructions.html")};BHP.drawFooter=function(){var e="footer-menu-bar";$("#"+e).remove();var t="body";var n={rewind:{name:"Rewind",icon:"step-backward",iconAfter:false},"undo-trick":{name:"Undo Previous Trick",icon:"backward",iconAfter:false},"undo-play":{name:"Undo Previous Play",icon:"chevron-left",iconAfter:false},"redo-play":{name:"Redo Next Play",icon:"chevron-right",iconAfter:true},"redo-trick":{name:"Redo Next Trick",icon:"forward",iconAfter:true},"fast-forward":{name:"Fast Forward",icon:"step-forward",iconAfter:true}};var r="btn-group-sm";var i="";i+='<div id="'+e+'" class="fixed btn-group '+r+'">';for(var s in n){i+='<button type="button" id="'+s+'" class="btn btn-'+BHP.BootstrapClass+'">';var o='<span class="glyphicon glyphicon-'+n[s].icon+'"></span>';if(!n[s].iconAfter){i+=o+" "}i+=n[s].name;if(n[s].iconAfter){i+=" "+o}i+="</button>"}i+="</div>";$(t).append(i);BHP.footer=$("#"+e);var u=BHP.viewport.width/2-BHP.footer.width()/2;BHP.footer.css({left:u,bottom:0});$("#undo-play").click(function(){BHP.undoCard();BHP.setHash()});$("#redo-play").click(function(){BHP.redoCard();BHP.setHash()});$("#undo-trick").click(function(){BHP.undoTrick();BHP.setHash()});$("#redo-trick").click(function(){BHP.redoTrick();BHP.setHash()});$("#rewind").click(function(){BHP.rewind();BHP.setHash()});$("#fast-forward").click(function(){BHP.fastForward();BHP.setHash()})};BHP.updateAnnotation=function(){var e="#annotation-area";$(e).html(BHP.deal.getAnnotation())};BHP.rewind=function(){BHP.undoCard();while(!BHP.deal.isAtBeginning()){BHP.undoCard()}};BHP.undoTrick=function(){BHP.undoCard();while(!BHP.deal.isAtBeginning()&&!BHP.deal.isEndOfTrick()){BHP.undoCard()}};BHP.fastForward=function(){BHP.redoCard();while(!BHP.deal.isAtEnd()){BHP.redoCard()}};BHP.redoTrick=function(){BHP.redoCard();while(!BHP.deal.isAtEnd()&&!BHP.deal.isEndOfTrick()){BHP.redoCard()}};BHP.redoCard=function(){var e=BHP.deal.redoCard();if(e==null)return;var t="#"+BHP.getCardID(e.suit,e.rank);var n=$(t);var r=n.attr("suit");var i=n.attr("rank");var s=n.attr("direction");n.attr("status","played");n.addClass("cursor-not-allowed");n.attr("src",BHP.cardImageDimensions.cardBackImage);if(BHP.deal.isNewTrick()){BHP.clearTableCards()}BHP.playTableCard($(t));BHP.setPlayableCards()};BHP.undoCard=function(){var e=BHP.deal.undoCard();if(e===null)return;var t="#card-"+e.suit+e.rank;var n="#played-"+t;$(t).attr("src",$(t).attr("imageName"));$(t).attr("status","not-played");var r=e.direction+"-played-card";$("#"+r).empty();if(BHP.deal.isEndOfTrick()){var i=BHP.deal.getTableCards();for(var s=0;s<i.length;++s){var o=i[s];var e="#"+BHP.getCardID(o.suit,o.rank);BHP.playTableCard($(e))}}BHP.setPlayableCards()};BHP.getCardID=function(e,t){return"card-"+e+t};BHP.showCard=function(e,t,n,r,i,s,o,u){var a=BHP.getCardID(t,n);var f=BHP.cardImageDimensions.folder+"/"+t+n+".png";var l="not-played";var c=f;$(e).append('<img id="'+a+'" class="fixed card"></img>');var h=$("#"+a);h.attr("src",c);h.attr("imageName",f);h.attr("status",l);h.attr("suit",t);h.attr("rank",n);h.attr("direction",r);h.css({width:o,height:u,top:i,left:s})};BHP.drawHands=function(){BHP.getHands();BHP.computeScalingFactor();for(var e in Bridge.Directions){if(e==="n"||e==="s"){BHP.drawHorizontal(e)}else{BHP.drawVertical(e)}}BHP.setPlayableCards()};BHP.drawNames=function(e,t,n){var r=BHP.deal.getName(e);if(r===null)r=Bridge.getDirectionName(e);var i=e+"-name";var s='<span id="'+i+'"  class="text-size fixed label label-'+BHP.BootstrapClass+'">'+r+"</span>";var o="#"+e+"-hand";$(o).append(s);var u=$("#"+i);u.css({top:t-u.outerHeight(),left:n})};BHP.playTableCard=function(e){var t=e.clone();var n="played-"+t.attr("id");t.attr("id",n);t.attr("src",t.attr("imageName"));var r=t.attr("direction");var n=r+"-played-card";t.removeClass("fixed").removeClass("card").removeClass("img-highlight").removeClass("cursor-not-allowed").addClass("cursor-pointer");$("#"+n).empty().append(t);$(t).click(function(){BHP.editAnnotation(this)})};BHP.editAnnotation=function(e){var t=$(e).attr("suit");var n=$(e).attr("rank");$("#add-card-annotation-title").html("Edit/Add Annotation for "+Bridge.getSuitName(t)+Bridge.getRankName(n));var r=BHP.deal.getAnnotationForCard(t,n);if(r===null)r="";$("#add-card-annotation-text").val(r).attr("suit",t).attr("rank",n);$("#add-card-annotation-modal").modal("show")};BHP.cardClicked=function(e){var t=$(e);var n=t.attr("suit");var r=t.attr("rank");var i=t.attr("direction");BHP.deal.playCard(n,r,i);$("#current-line").html("Unsaved");t.attr("status","played");t.addClass("cursor-not-allowed");t.attr("src",BHP.cardImageDimensions.cardBackImage);if(BHP.deal.isNewTrick()){BHP.clearTableCards()}BHP.playTableCard($(e));BHP.setPlayableCards();BHP.setHash()};BHP.setActiveHand=function(e){for(var t in Bridge.Directions){var n=t+"-name";var r=$("#"+n);if(t===e){r.removeClass("label-"+BHP.BootstrapClass).addClass("label-primary")}else{r.addClass("label-"+BHP.BootstrapClass).removeClass("label-primary")}}};BHP.updateButtonStatus=function(){var e=BHP.deal.isAtBeginning();$("#rewind").attr("disabled",e);$("#undo-trick").attr("disabled",e);$("#undo-play").attr("disabled",e);var t=BHP.deal.isAtEnd();$("#redo-trick").attr("disabled",t);$("#redo-play").attr("disabled",t);$("#fast-forward").attr("disabled",t)};BHP.setPlayableCards=function(){var e="img-highlight";$(".card").unbind("click").removeClass(e).addClass("cursor-not-allowed");var t=BHP.deal.getNextToPlay();var n="[direction="+t+'][status="not-played"]';var r=BHP.deal.getSuitLed();if(r!==null){var i=n+'[suit="'+r+'"]';var s=$(i).length;if(s>0)n=i}$(n).addClass(e).removeClass("cursor-not-allowed").click(function(){BHP.cardClicked(this)});BHP.setActiveHand(t);BHP.updateButtonStatus();BHP.updateAnnotation();$("#ns-tricks").html("NS Tricks : "+BHP.deal.getNSTricks());$("#ew-tricks").html("EW Tricks : "+BHP.deal.getEWTricks())};BHP.drawHorizontal=function(e){var t="#"+e+"-hand";$(t).empty();var n=BHP.cardImageDimensions.width*BHP.scalingFactor;var r=BHP.cardImageDimensions.height*BHP.scalingFactor;var i=r;var s=12*n*BHP.cardImageDimensions.percentageWidthShowing+n;var o=$(t).position().top+$(t).outerHeight()/2-i/2;var u=$(t).position().left+$(t).outerWidth()/2-s/2;BHP.drawNames(e,o,u);for(var a=0;a<Bridge.CardSuitOrder.length;++a){var f=Bridge.CardSuitOrder[a];var l=BHP.hands[e].cards[f];if(l.length>0){for(var c=0;c<l.length;++c){var h=l[c];BHP.showCard("body",f,h,e,o,u,n,r);u+=n*BHP.cardImageDimensions.percentageWidthShowing}}}};BHP.drawVertical=function(e){var t="#"+e+"-hand";$(t).empty();var n=BHP.cardImageDimensions.width*BHP.scalingFactor;var r=BHP.cardImageDimensions.height*BHP.scalingFactor;var i=3*r*BHP.cardImageDimensions.percentageHeightShowing+r;var s=(BHP.hands[e].longest-1)*n*BHP.cardImageDimensions.percentageWidthShowing+n;var o=$(t).position().top+$(t).outerHeight()/2-i/2;var u=$(t).position().left+$(t).outerWidth()/2-s/2;BHP.drawNames(e,o,u);for(var a=0;a<Bridge.CardSuitOrder.length;++a){var f=u;var l=Bridge.CardSuitOrder[a];var c=BHP.hands[e].cards[l];for(var h=0;h<c.length;++h){var p=c[h];BHP.showCard(t,l,p,e,o,f,n,r);f+=n*BHP.cardImageDimensions.percentageWidthShowing}o+=r*BHP.cardImageDimensions.percentageHeightShowing}};BHP.getHorizontalWidth=function(e){var t=BHP.hands[e];var n=0;for(var r=0;r<Bridge.CardSuitOrder.length;++r){var i=Bridge.CardSuitOrder[r];if(t.cards[i].length>0){n+=(t.cards[i].length-1)*BHP.cardImageDimensions.width*BHP.cardImageDimensions.percentageWidthShowing+BHP.cardImageDimensions.width;firstSuit=false}}return n};BHP.getVerticalWidth=function(e){var t=BHP.hands[e];return(t.longest-1)*BHP.cardImageDimensions.width*BHP.cardImageDimensions.percentageWidthShowing+BHP.cardImageDimensions.width};BHP.getHorizontalHeight=function(e){var t=BHP.hands[e];return BHP.cardImageDimensions.height};BHP.getVerticalHeight=function(e){var t=BHP.hands[e];var n=0;for(var r=0;r<Bridge.CardSuitOrder.length;++r){var i=Bridge.CardSuitOrder[r];if(t.cards[i].length>0)n++}return(n-1)*BHP.cardImageDimensions.height*BHP.cardImageDimensions.percentageHeightShowing+BHP.cardImageDimensions.height};BHP.getHands=function(){BHP.hands={};for(var e in Bridge.Directions){var t=BHP.deal.getHand(e);BHP.hands[e]={};BHP.hands[e].count={};BHP.hands[e].cards={};for(var n=0;n<Bridge.CardSuitOrder.length;++n){var r=Bridge.CardSuitOrder[n];BHP.hands[e].cards[r]=[];BHP.hands[e].count[r]=0;for(var i=0;i<Bridge.RankOrder.length;++i){var s=Bridge.RankOrder[i];if(s in t.cards[r]){BHP.hands[e].count[r]++;BHP.hands[e].cards[r].push(s)}}}BHP.hands[e].longest=Math.max(BHP.hands[e].count["s"],BHP.hands[e].count["h"],BHP.hands[e].count["d"],BHP.hands[e].count["c"]);if(e==="n"||e==="s"){BHP.hands[e].height=BHP.getHorizontalHeight(e);BHP.hands[e].width=BHP.getHorizontalWidth(e)}else{BHP.hands[e].height=BHP.getVerticalHeight(e);BHP.hands[e].width=BHP.getVerticalWidth(e)}}};BHP.computeScalingFactor=function(){BHP.scalingFactor=100;for(var e in Bridge.Directions){var t="#"+e+"-hand";var n=BHP.hands[e];var r=$(t).outerWidth()-2*BHP.gutter;var i=$(t).outerHeight()-2*BHP.gutter;var s=r/n.width;var o=i/n.height;BHP.scalingFactor=Math.min(BHP.scalingFactor,s,o);var u="<style>";u+="table.table {font-size: "+BHP.fontSize*BHP.scalingFactor+"px;}";u+=".text-size {font-size: "+BHP.fontSize*BHP.scalingFactor+"px;}";u+="</style>";$(u).appendTo("head")}};BHP.drawPlayingTable=function(){var e=$("#playing-table");e.addClass("card-table");var t="compass-area";var n='<img id="'+t+'" class="fixed"></img>';e.append(n);var r=$("#"+t);r.attr("src","images/compass.png");var i=.15*e.outerWidth();var s=i;var o=e.position().top+e.outerHeight()/2-s/2;var u=e.position().left+e.outerWidth()/2-i/2;var a={width:i,height:s,top:o,left:u};r.css(a);var f="n-played-card";var n='<div id="'+f+'" class="fixed"></div>';e.append(n);var l=$("#"+f);var o=e.position().top;var u=e.position().left+e.outerWidth()/2-BHP.cardImageDimensions.width*BHP.scalingFactor/2;var i=BHP.cardImageDimensions.width*BHP.scalingFactor;var s=BHP.cardImageDimensions.height*BHP.scalingFactor;l.css({left:u,top:o,width:i,height:s});var f="e-played-card";var n='<div id="'+f+'" class="fixed"></div>';e.append(n);var l=$("#"+f);var o=e.position().top+e.outerHeight()/2-BHP.cardImageDimensions.height*BHP.scalingFactor/2;var i=BHP.cardImageDimensions.width*BHP.scalingFactor;var s=BHP.cardImageDimensions.height*BHP.scalingFactor;var u=e.position().left+e.outerWidth()-i;l.css({left:u,top:o,width:i,height:s});var f="s-played-card";var n='<div id="'+f+'" class="fixed"></div>';e.append(n);var l=$("#"+f);var u=e.position().left+e.outerWidth()/2-BHP.cardImageDimensions.width*BHP.scalingFactor/2;var i=BHP.cardImageDimensions.width*BHP.scalingFactor;var s=BHP.cardImageDimensions.height*BHP.scalingFactor;var o=e.position().top+e.outerHeight()-s;l.css({left:u,top:o,width:i,height:s});var f="w-played-card";var n='<div id="'+f+'" class="fixed"></div>';e.append(n);var l=$("#"+f);var o=e.position().top+e.outerHeight()/2-BHP.cardImageDimensions.height*BHP.scalingFactor/2;var u=e.position().left;var i=BHP.cardImageDimensions.width*BHP.scalingFactor;var s=BHP.cardImageDimensions.height*BHP.scalingFactor;l.css({left:u,top:o,width:i,height:s});BHP.clearTableCards()};BHP.clearTableCards=function(){for(var e in Bridge.Directions){var t=e+"-played-card";$("#"+t).empty()}};BHP.drawMainSection=function(){var e=[{id:"general-messages",name:"Cell 0 0",height:3,width:3,"class":"status",left:0,top:0,widthGutters:1,heightGutters:1},{id:"n-hand",name:"Cell 0 0",height:3,width:6,"class":"alert",left:3,top:0,widthGutters:2,heightGutters:1},{id:"auction",name:"Cell 0 0",height:3,width:3,"class":"status",left:9,top:0,widthGutters:3,heightGutters:1},{id:"w-hand",name:"Cell 0 0",height:6,width:4,"class":"alert",left:0,top:3,widthGutters:1,heightGutters:2},{id:"playing-table",name:"Cell 0 0",height:6,width:4,"class":"well",left:4,top:3,widthGutters:2,heightGutters:2},{id:"e-hand",name:"Cell 0 0",height:6,width:4,"class":"alert",left:8,top:3,widthGutters:3,heightGutters:2},{id:"deal-information",name:"Cell 0 0",height:3,width:3,"class":"status",left:0,top:9,widthGutters:1,heightGutters:3},{id:"s-hand",name:"Cell 0 0",height:3,width:6,"class":"alert",left:3,top:9,widthGutters:2,heightGutters:3},{id:"annotation-area",name:"Cell 0 0",height:3,width:3,"class":"status alert alert-"+BHP.BootstrapClass,left:9,top:9,widthGutters:3,heightGutters:3}];BHP.header=$("#header");var t=BHP.footer.position().top-BHP.header.position().top-BHP.header.height();var n=BHP.viewport.width;var r=(t-4*BHP.gutter)/12;var i=(n-4*BHP.gutter)/12;var s="#section";var o=BHP.header.position().top+BHP.header.height();var u=0;for(var a=0;a<e.length;++a){var f=e[a];var l=o+f.heightGutters*BHP.gutter+f.top*r;var c=u+f.widthGutters*BHP.gutter+f.left*i;var h=f.height*r;var p=f.width*i;var d='<div id="'+f.id+'" class="'+f.class+' fixed"></div>';$(s).append(d);var f=$("#"+f.id);f.css({top:l,left:c,width:p,height:h})}};BHP.drawTitles=function(){var e="#section";var t="Play Annotations";var n="annotation-area-title";var r='<span id="'+n+'"  class="text-size fixed label label-'+BHP.BootstrapClass+'">'+t+"</span>";var i="#annotation-area";$(e).append(r);var s=$("#"+n);s.css({top:$(i).position().top-s.outerHeight(),left:$(i).position().left})};BHP.drawAll=function(){BHP.viewport={width:jQuery(window).width(),height:jQuery(window).height()};var e="#section";$(e).empty();$("#save-play-modal").modal("hide");$("#add-card-annotation-modal").modal("hide");$("#generate-url-modal").modal("hide");BHP.drawFooter();BHP.drawMainSection();BHP.drawHands();BHP.drawPlayingTable();BHP.drawAuction();BHP.drawDealInformation();BHP.drawTitles();BHP.deal.resetPlayedCardIndex();BHP.manualHashChange=false;BHP.processHash()};BHP.loadClickHandlers=function(){$("#save-play").click(function(){$("#save-play-modal").modal("show")});$("#save-play-ok").click(function(){var e=$("#save-play-name").val();if(!e){alert("Play name cannot be empty!")}else{e=unescape(e);try{BHP.deal.savePlay(e);$("#current-line").html(e)}catch(t){alert(t);return}$("#save-play-modal").modal("hide");var n=$("#lines");var r=BHP.savedPlayCount;BHP.savedPlayCount++;var i="line-"+r;var s='<li><a class="btn" id="'+i+'">'+e+"</a></li>";n.append(s);$("#"+i).click(function(){BHP.loadSavedPlay(this)})}});$("#save-card-annotation-ok").click(function(){var e=$("#add-card-annotation-text");var t=e.attr("suit");var n=e.attr("rank");var r=e.val();BHP.deal.setAnnotationForCard(t,n,r);BHP.updateAnnotation();$("#add-card-annotation-modal").modal("hide")});$(".generate-url").tooltip({placement:"left"});$(".generate-url").click(function(){var e=$(this).attr("all").toLowerCase()==="true";var t=BHP.createURLQueryParameters(e);var n=$(this).attr("id");if(n==="bbo_url"){var r="http://www.bridgebase.com/tools/handviewer.html?"+t;var i='<a target="_blank" href="'+r+'">Click this link to go to BBO Handviewer URL</a>';i+="<br/>";i+="OR ";$("#generate-url-href").empty().append(i);$("#generate-url-text").val(r)}else if(n==="bw_url"){var s="{handviewer "+t+"}";$("#generate-url-text").val(s)}else if(n==="bhp_url"){var r="http://localhost/bridge-hand-player/bridge-hand-player.html?"+t;var i='<a target="_blank" href="'+r+'">Click this link to go to BHP URL</a>';i+="<br/>";i+="OR ";$("#generate-url-href").empty().append(i);$("#generate-url-text").val(r)}else{alert("Invalid ID : "+n);return}$("#generate-url-modal").modal("show")})};BHP.loadPlayByName=function(e,t){BHP.deal.resetAll();var n=e.toLowerCase();for(var r=0;r<n.length;++r){var i=null;var s=n.charAt(r);Bridge.checkCardSuit(s);r++;prefix="In play "+t+" at position "+(r+1)+" - ";if(r>=n.length){throw prefix+" No rank has been specified for suit "+s}var o=n.charAt(r);Bridge.checkRank(o);if(n.charAt(r+1)==="{"){var u=BHP.parseAnnotation(e,r+1);if(!u){throw prefix+" No closing } found!"}i=u.annotation;r=u.endBracePosition}BHP.deal.playCard(s,o,null,i)}BHP.rewind();BHP.deal.savePlay(t);var a=$("#lines");var f=BHP.savedPlayCount;BHP.savedPlayCount++;var l="line-"+f;var c='<li><a class="btn" id="'+l+'">'+unescape(t)+"</a></li>";a.append(c);$("#"+l).click(function(){BHP.loadSavedPlay(this)})};BHP.loadSavedPlay=function(e){var t=$(e).html();BHP.rewind();BHP.deal.loadPlay(t);$("#current-line").html(t)};BHP.loadPlay=function(){var e=null;try{for(var t in BHP.queryParameters){var n=t.charAt(0).toLowerCase();if(n==="p"){var r=t.substr(1);if(!r)r="Default";if(e===null)e=r;var i=BHP.queryParameters[t];r=unescape(r);BHP.loadPlayByName(i,r)}}if(e!==null){e=unescape(e);BHP.deal.loadPlay(e);$("#current-line").html(e)}}catch(s){BHP.addError(s)}};BHP.manageColorThemes=function(){var e=$.cookie("bootswatch_theme");if(e!==undefined){var t=JSON.parse(e);$("#bootswatch-theme").attr({href:t.cssCdn});$("#current-theme").html(t.name)}$.get("http://api.bootswatch.com/3/",function(e){var t='<li><a class="theme-name" href="javascript:void(0);" id="default">Default</a></li>';BHP.bootswatchThemes["default"]={name:"Default",cssCdn:"//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css"};var n=e.themes;for(var r=0;r<n.length;r++){var i=n[r].name.toLowerCase();BHP.bootswatchThemes[i]=n[r];t+='<li><a class="theme-name" href="javascript:void(0);" id="'+i+'">';t+='<img width="25" height="25" src="'+n[r].thumbnail+'" alt="'+n[r].name+'"></img> '+n[r].name;t+="</a></li>"}$("#themes").html(t);$(".theme-name").click(function(){var e=$(this).attr("id");var t="http:"+BHP.bootswatchThemes[e].cssCdn;$.cookie("bootswatch_theme",JSON.stringify(BHP.bootswatchThemes[e]));$("#bootswatch-theme").attr({href:t});$("#current-theme").html(BHP.bootswatchThemes[e].name)})})};BHP.createURLQueryParameters=function(e){if(e===undefined)e=false;var t="";var n=[];var r="";for(var i in Bridge.Directions){var s=BHP.deal.getHand(i);var o=BHP.deal.getName(i);if(o){r+="&"+i+"n="+o}var u="";for(var a in s.cards){u+=a;for(var f in s.cards[a]){u+=f}}n.push(i+"="+u)}t+=n.join("&");t+=r;var l=BHP.deal.getBoard();if(l!==null)t+="&b="+l;var c=BHP.deal.getDealer();if(c!==null)t+="&d="+c;var h=BHP.deal.getVulnerability();if(h!==null)t+="&v="+h;var p=BHP.deal.getAuction();if(p.length===0)t+="&a="+BHP.contractString;else{t+="&a=";for(var d=0;d<p.length;++d){var v=p[d];var a=v.getSuit();if(a==="p"||a==="x"||a==="r")t+=a;else t+=v.getLevel()+a;var m=v.getAnnotation();if(m!==null)t+="{"+m+"}"}}t+=BHP.deal.getPlayStrings(e);var g=BHP.deal.getNotes();if(g!==null)t+="&t="+g;return t};BHP.changeToPlay=function(e){if(!BHP.deal.isValidPlayNumber(e)){return false}var t=BHP.deal.getPlayNumber();if(e<t){while(!BHP.deal.isAtBeginning()&&!BHP.deal.isAtPlayNumber(e)){BHP.undoCard()}}else if(e>t){while(!BHP.deal.isAtEnd()&&!BHP.deal.isAtPlayNumber(e)){BHP.redoCard()}}return true};BHP.processHash=function(){if(!BHP.manualHashChange){var e=location.hash.substring(1);var t=e?parseInt(e):0;return BHP.changeToPlay(t)}BHP.manualHashChange=false};BHP.setHash=function(){BHP.manualHashChange=true;window.location.hash=BHP.deal.getPlayNumber()};$(function(){BHP.deal=new Bridge.Deal;BHP.manageColorThemes();BHP.errors=[];BHP.readQueryParameters();if(BHP.queryParameters){BHP.instructions=$("#instructions").html();$("#instructions").remove();try{BHP.loadDealInformation();BHP.loadNames();BHP.loadHands();BHP.loadAuction();BHP.loadPlay()}catch(e){BHP.addError(e)}if(BHP.errors.length>0){BHP.showErrors();return}else{BHP.drawAll();BHP.loadClickHandlers();$(window).resize(function(){BHP.drawAll()});$(window).hashchange(function(){BHP.processHash()})}}else{var t="#section";html='<div id="postamble" class="padding-top"></div>';$(t).append(html);$("#postamble").load("instructions.html")}})