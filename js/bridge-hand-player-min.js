jQuery.browser={};(function(){jQuery.browser.msie=!1;jQuery.browser.version=0;navigator.userAgent.match(/MSIE ([0-9]+)\./)&&(jQuery.browser.msie=!0,jQuery.browser.version=RegExp.$1)})();var Bridge={Suits:{n:{name:"NT"},s:{name:'<font color="000000">&spades;</font>'},h:{name:'<font color="CB0000">&hearts;</font>'},d:{name:'<font color="CB0000">&diams;</font>'},c:{name:'<font color="000000">&clubs;</font>'}},getSuitName:function(a){return Bridge.Suits[a].name},CardSuitOrder:["s","h","d","c"],checkCardSuit:function(a){if(-1===Bridge.CardSuitOrder.indexOf(a))throw a+" is not a valid Card Suit!";},BidSuitOrder:["n","s","h","d","c"],checkBidSuit:function(a){if(-1===Bridge.BidSuitOrder.indexOf(a))throw a+
" is not a valid Bid Suit!";},Ranks:{a:{name:"A",index:0},k:{name:"K",index:1},q:{name:"Q",index:2},j:{name:"J",index:3},t:{name:"T",index:4},9:{name:"9",index:5},8:{name:"8",index:6},7:{name:"7",index:7},6:{name:"6",index:8},5:{name:"5",index:9},4:{name:"4",index:10},3:{name:"3",index:11},2:{name:"2",index:12}},getRankName:function(a){return Bridge.Ranks[a].name},RankOrder:"akqjt98765432".split(""),checkRank:function(a){if(!(a in Bridge.Ranks))throw a+" is not a valid Rank!";return!0},isGreaterRank:function(a,
b){var c=Bridge.RankOrder.indexOf(a),d=Bridge.RankOrder.indexOf(b);return c<d},Directions:{n:{name:"North",layout:"horizontal",position:"top",lho:"e",rho:"w"},e:{name:"East",layout:"vertical",position:"right",lho:"s",rho:"n"},s:{name:"South",layout:"horizontal",position:"bottom",lho:"w",rho:"e"},w:{name:"West",layout:"vertical",position:"left",lho:"n",rho:"s"}},getDirectionName:function(a){return Bridge.Directions[a].name},DirectionOrder:["n","e","s","w"],checkDirection:function(a){if(!(a in Bridge.Directions))throw a+
" is not a valid direction!";return!0},areOppositeDirections:function(a,b){return("n"===a||"s"===a)&&("e"===b||"w"===b)||("e"===a||"w"===a)&&("n"===b||"s"===b)},checkLevel:function(a){if(isNaN(a)||1>a||7<a)throw a+" is a not a valid bidding level!";},checkVulnerability:function(a){if(!(a in Bridge.Vulnerability))throw a+" is not a valid Vulnerability!";},getLHO:function(a){Bridge.checkDirection(a);return Bridge.Directions[a].lho},getRHO:function(a){Bridge.checkDirection(a);return Bridge.Directions[a].rho},
Vulnerability:{"-":{name:"None"},n:{name:"North-South"},e:{name:"East-West"},b:{name:"Both"}},getVulnerabilityName:function(a){return Bridge.Vulnerability[a].name},Card:function(a,b,c){Bridge.checkCardSuit(a);this.suit=a;Bridge.checkRank(b);this.rank=b;void 0===c?this.direction=null:(Bridge.checkDirection(c),this.direction=c);this.played=!1}};
Bridge.Card.prototype.play=function(){if(this.played)throw Bridge.getSuitName(this.suit)+Bridge.getRankName(this.rank)+" has already been played!";this.played=!0};Bridge.Card.prototype.reset=function(){this.played=!1};Bridge.Card.prototype.undo=function(){if(!this.played)throw Bridge.getSuitName(this.suit)+Bridge.getRankName(this.rank)+" has not been played!";this.played=!1};Bridge.Card.prototype.getDirection=function(){return this.direction};
Bridge.Card.prototype.setDirection=function(a){this.direction=a};Bridge.Cards={};for(var i=0;i<Bridge.CardSuitOrder.length;++i){var suit=Bridge.CardSuitOrder[i];Bridge.Cards[suit]={};for(var rank in Bridge.Ranks)Bridge.Ranks.hasOwnProperty(rank)&&(Bridge.Cards[suit][rank]=new Bridge.Card(suit,rank))}Bridge.Cards.isAssigned=function(a,b){Bridge.checkCardSuit(a);Bridge.checkRank(b);return null!==Bridge.Cards[a][b].getDirection()};
Bridge.Cards.reset=function(){for(var a=0;a<Bridge.CardSuitOrder.length;++a){var b=Bridge.CardSuitOrder[a],c;for(c in Bridge.Ranks)Bridge.Ranks.hasOwnProperty(c)&&Bridge.Cards[b][c].reset()}};
Bridge.PlayedCard=function(a,b,c,d){void 0===d&&(d=null);Bridge.checkCardSuit(a);Bridge.checkRank(b);Bridge.checkDirection(c);this.suit=a;this.rank=b;this.direction=c;this.annotation=d;this.previousPlayedCard=this.nextPlayedCard=null;this.playNumber=0;this.ledCard=this.trickWinner=null;this.nsTricks=this.ewTricks=0};
Bridge.PlayedCard.prototype.winTrick=function(a){if(1===this.playNumber%4)return!0;var b=this.getTrickWinner(),c=b.getSuit(),b=b.getRank();return this.suit!==a?c!==a&&this.suit===c&&Bridge.isGreaterRank(this.rank,b)?!0:!1:c!==a||Bridge.isGreaterRank(this.rank,b)?!0:!1};Bridge.PlayedCard.prototype.getNextToPlay=function(){return 0===this.playNumber%4?this.trickWinner.direction:Bridge.getLHO(this.direction)};
Bridge.PlayedCard.prototype.getSuitLed=function(){if(0===this.playNumber%4)return null;for(var a=this;1!==a.getPlayNumber()%4;)a=a.getPreviousCard();return a.getSuit()};Bridge.PlayedCard.prototype.setNSTricks=function(a){this.nsTricks=a};Bridge.PlayedCard.prototype.setEWTricks=function(a){this.ewTricks=a};Bridge.PlayedCard.prototype.getNSTricks=function(){return this.nsTricks};Bridge.PlayedCard.prototype.getEWTricks=function(){return this.ewTricks};Bridge.PlayedCard.prototype.incrementNSTricks=function(){this.nsTricks++};
Bridge.PlayedCard.prototype.incrementEWTricks=function(){this.ewTricks++};Bridge.PlayedCard.prototype.getAnnotation=function(){return this.annotation};Bridge.PlayedCard.prototype.setAnnotation=function(a){this.annotation=a};Bridge.PlayedCard.prototype.getDirection=function(){return this.direction};Bridge.PlayedCard.prototype.setDirection=function(a){this.direction=a};Bridge.PlayedCard.prototype.getTrickWinner=function(){return this.trickWinner};
Bridge.PlayedCard.prototype.setTrickWinner=function(a){this.trickWinner=a};Bridge.PlayedCard.prototype.getPlayNumber=function(){return this.playNumber};Bridge.PlayedCard.prototype.setPlayNumber=function(a){this.playNumber=a};Bridge.PlayedCard.prototype.getPreviousCard=function(){return this.previousPlayedCard};Bridge.PlayedCard.prototype.getNextCard=function(){return this.nextPlayedCard};Bridge.PlayedCard.prototype.getSuit=function(){return this.suit};Bridge.PlayedCard.prototype.getRank=function(){return this.rank};
Bridge.PlayedCard.prototype.setNextCard=function(a){this.nextPlayedCard=a};Bridge.PlayedCard.prototype.setPreviousCard=function(a){this.previousPlayedCard=a};Bridge.Bid=function(a,b,c,d,e){void 0===e&&(e=null);void 0===d&&(d=null);"p"===b||"x"===b||"r"===b?this.suit=b:(Bridge.checkBidSuit(b),this.suit=b,Bridge.checkLevel(a),this.level=a);Bridge.checkDirection(c);this.direction=c;this.annotation=e;this.explanation=d;this.nextBid=this.previousBid=null};
Bridge.Bid.prototype.getString=function(){var a="",a="x"===this.suit?'<font color="red">X</font>':"r"===this.suit?'<font color="blue">XX<font>':"p"===this.suit?'<font color="green">P</font>':this.suit in Bridge.Suits?this.level+Bridge.getSuitName(this.suit):"Unknown";return{bid:a,annotation:this.annotation,explanation:this.explanation}};Bridge.Bid.prototype.getLevel=function(){return this.level};Bridge.Bid.prototype.getSuit=function(){return this.suit};Bridge.Bid.prototype.getDirection=function(){return this.direction};
Bridge.Bid.prototype.getExplanation=function(){return this.explanation};Bridge.Bid.prototype.setExplanation=function(a){this.explanation=a};Bridge.Bid.prototype.getAnnotation=function(){return this.annotation};Bridge.Bid.prototype.setAnnotation=function(a){this.annotation=a};Bridge.Bid.prototype.getNextBid=function(){return this.nextBid};Bridge.Bid.prototype.setNextBid=function(a){this.nextBid=a};Bridge.Bid.prototype.getPreviousBid=function(){return this.previousBid};
Bridge.Bid.prototype.setPreviousBid=function(a){this.previousBid=a};Bridge.Bid.prototype.countPasses=function(){var a=this,b=0;for("p"===a.getSuit()&&b++;"p"===a.getSuit()&&null!==a.getPreviousBid();)a=a.getPreviousBid(),"p"===a.getSuit()&&b++;return b};Bridge.Hand=function(a){this.cards={};this.name=null;this.direction=a;this.numCards=0;this.cardCount={};for(a=0;a<Bridge.CardSuitOrder.length;++a){var b=Bridge.CardSuitOrder[a];this.cards[b]={};this.cardCount[b]=0}};
Bridge.Hand.prototype.hasCard=function(a,b){return a in this.cards&&b in this.cards[a]?!0:!1};Bridge.Hand.prototype.setName=function(a){this.name=a};Bridge.Hand.prototype.getName=function(){return this.name};Bridge.Hand.prototype.getNumCards=function(){return this.numCards};Bridge.Hand.prototype.addCard=function(a,b){Bridge.checkCardSuit(a);Bridge.checkRank(b);this.cards[a][b]=Bridge.Cards[a][b];this.numCards++;this.cardCount[a]++};
Bridge.Hand.prototype.removeCard=function(a,b){Bridge.checkCardSuit(a);Bridge.checkRank(b);if(void 0===this.cards[a][b])throw"In Bridge.Hand.removeCard "+Bridge.getSuitName(a)+Bridge.getRankName(b)+" is not found!";delete this.cards[a][b];this.cardCount[a]--;this.numCards--};Bridge.Hand.prototype.getLongestSuit=function(){for(var a=0,b=0;b<Bridge.CardSuitOrder.length;++b)a=Math.max(a,this.cardCount[Bridge.CardSuitOrder[b]]);return a};
Bridge.Deal=function(){this.hands={};for(var a in Bridge.Directions)Bridge.Directions.hasOwnProperty(a)&&(this.hands[a]=new Bridge.Hand(a));this.lastBid=this.firstBid=null;this.currentLevels={level:0,suit:"",direction:"",doubled:!1,redoubled:!1};this.savedAuctions={};this.loadedAuction=null;this.board=1;this.dealer="n";this.vulnerability="-";this.currentPlayedCard=this.lastPlayedCard=this.firstPlayedCard=this.notes=this.contract=this.leader=this.trumpSuit=null;this.savedPlays={};this.loadedPlay=null};
Bridge.Deal.prototype.isAtBeginning=function(){return null===this.currentPlayedCard};Bridge.Deal.prototype.isAtEnd=function(){return this.currentPlayedCard===this.lastPlayedCard};Bridge.Deal.prototype.isValidPlayNumber=function(a){return isNaN(a)||0>a?!1:null===this.lastPlayedCard?0===a:a<=this.lastPlayedCard.getPlayNumber()};Bridge.Deal.prototype.getPlayNumber=function(){return null===this.currentPlayedCard?0:this.currentPlayedCard.getPlayNumber()};
Bridge.Deal.prototype.isAtPlayNumber=function(a){return null===this.currentPlayedCard?!1:this.currentPlayedCard.getPlayNumber()===a};Bridge.Deal.prototype.isNewTrick=function(){return null===this.currentPlayedCard||1===this.currentPlayedCard.getPlayNumber()%4?!0:!1};Bridge.Deal.prototype.isEndOfTrick=function(){return null===this.currentPlayedCard||0===this.currentPlayedCard.getPlayNumber()%4?!0:!1};
Bridge.Deal.prototype.getTableCards=function(){var a=this.currentPlayedCard,b=[];if(null===a)return b;b.push({suit:a.getSuit(),rank:a.getRank()});for(a=a.getPreviousCard();null!==a&&0!==a.getPlayNumber()%4;)b.push({suit:a.getSuit(),rank:a.getRank()}),a=a.getPreviousCard();return b};
Bridge.Deal.prototype.playCard=function(a,b,c,d){if(void 0===c||null===c)c=null===this.currentPlayedCard?this.leader:this.currentPlayedCard.getNextToPlay();void 0===d&&(d=null);d=new Bridge.PlayedCard(a,b,c,d);if(!this.hands[c].hasCard(a,b))throw Bridge.getDirectionName(c)+" does not have "+Bridge.getSuitName(a)+Bridge.getRankName(b)+"!";null!==this.currentPlayedCard?(this.currentPlayedCard.setNextCard(d),d.setPlayNumber(this.currentPlayedCard.getPlayNumber()+1),d.setPreviousCard(this.currentPlayedCard),
this.lastPlayedCard=d,d.setTrickWinner(this.currentPlayedCard.getTrickWinner()),d.winTrick(this.trumpSuit)&&d.setTrickWinner(d),d.setEWTricks(this.currentPlayedCard.getEWTricks()),d.setNSTricks(this.currentPlayedCard.getNSTricks())):(this.lastPlayedCard=this.firstPlayedCard=d,d.setPlayNumber(1),d.setTrickWinner(d));this.currentPlayedCard=d;0===this.currentPlayedCard.getPlayNumber()%4&&(c=this.currentPlayedCard.getTrickWinner().getDirection(),"n"===c||"s"===c?this.currentPlayedCard.incrementNSTricks():
this.currentPlayedCard.incrementEWTricks());this.loadedPlay=null;Bridge.Cards[a][b].play()};Bridge.Deal.prototype.hasUnsavedPlay=function(){return null===this.loadedPlay};Bridge.Deal.prototype.setAnnotationForCard=function(a,b,c){for(var d=this.firstPlayedCard;null!==d;){if(d.getSuit()===a&&d.getRank()===b){d.setAnnotation(c);return}d=d.getNextCard()}throw"Card "+a+b+" was not found when trying to add annotation!";};
Bridge.Deal.prototype.setAnnotationForBid=function(a,b){for(var c=this.firstBid,d=0;null!==c&&d!==a;)c=c.getNextBid(),d++;if(null!==c)c.setAnnotation(b);else throw"Bid was not found when trying to add annotation!";};Bridge.Deal.prototype.setExplanationForBid=function(a,b){for(var c=this.firstBid,d=0;null!==c&&d!==a;)c=c.getNextBid(),d++;if(null!==c)c.setExplanation(b);else throw"Bid was not found when trying to add explanation!";};
Bridge.Deal.prototype.getAnnotationForCard=function(a,b){for(var c=this.firstPlayedCard;null!==c;){if(c.getSuit()===a&&c.getRank()===b)return c.getAnnotation();c=c.getNextCard()}throw"Card "+a+b+" was not found when trying to add annotation!";};Bridge.Deal.prototype.getAnnotationForBid=function(a){for(var b=this.firstBid,c=0;null!==b&&c!==a;)b=b.getNextBid(),c++;if(null!==b)return b.getAnnotation();throw"Bid was not found when trying to add annotation!";};
Bridge.Deal.prototype.getExplanationForBid=function(a){for(var b=this.firstBid,c=0;null!==b&&c!==a;)b=b.getNextBid(),c++;if(null!==b)return b.getExplanation();throw"Bid was not found when trying to get explanation!";};Bridge.Deal.prototype.resetPlayedCardIndex=function(){this.currentPlayedCard=null;Bridge.Cards.reset()};Bridge.Deal.prototype.resetAll=function(){this.lastPlayedCard=this.firstPlayedCard=this.currentPlayedCard=null;Bridge.Cards.reset()};
Bridge.Deal.prototype.deletePlays=function(){this.loadedPlay=this.lastPlayedCard=this.firstPlayedCard=this.currentPlayedCard=null;this.savedPlays=[];Bridge.Cards.reset()};
Bridge.Deal.prototype.savePlay=function(a){if(a in this.savedPlays)throw"There is already a saved play with name "+a+". Please use a different name.";var b=0;null!==this.currentPlayedCard&&(b=this.currentPlayedCard.getPlayNumber());this.savedPlays[a]={firstPlayedCard:this.firstPlayedCard,currentPlayNumber:b,lastPlayedCard:this.lastPlayedCard};this.loadedPlay=a};Bridge.Deal.prototype.getSavedPlayNumber=function(){return this.savedPlays.length};
Bridge.Deal.prototype.getSavedPlayNames=function(){var a=[],b;for(b in this.savedPlays)this.savedPlays.hasOwnProperty(b)&&a.push(b);return a};Bridge.Deal.prototype.loadPlay=function(a){if(!(a in this.savedPlays))return alert(a+" is not a valid saved line of play!"),null;var b=this.savedPlays[a];this.firstPlayedCard=b.firstPlayedCard;this.lastPlayedCard=b.lastPlayedCard;this.loadedPlay=a;return b.currentPlayNumber};
Bridge.Deal.prototype.undoCard=function(){if(null===this.currentPlayedCard)return null;var a={suit:this.currentPlayedCard.getSuit(),rank:this.currentPlayedCard.getRank(),direction:this.currentPlayedCard.getDirection()};this.currentPlayedCard=this.currentPlayedCard.getPreviousCard();Bridge.Cards[a.suit][a.rank].undo();return a};
Bridge.Deal.prototype.redoCard=function(){if(null===this.currentPlayedCard){if(null===this.firstPlayedCard)return null;this.currentPlayedCard=this.firstPlayedCard}else{var a=this.currentPlayedCard.getNextCard();if(null===a)return null;this.currentPlayedCard=a}a={suit:this.currentPlayedCard.getSuit(),rank:this.currentPlayedCard.getRank(),direction:this.currentPlayedCard.getDirection()};Bridge.Cards[a.suit][a.rank].play();return a};
Bridge.Deal.prototype.getNextToPlay=function(){return null!==this.currentPlayedCard?this.currentPlayedCard.getNextToPlay():this.leader};Bridge.Deal.prototype.getSuitLed=function(){return null!==this.currentPlayedCard?this.currentPlayedCard.getSuitLed():null};Bridge.Deal.prototype.hasBids=function(){return null!==this.lastBid};
Bridge.Deal.prototype.determineDeclarer=function(){var a=0,b="",c=!1,d=!1,a=this.numPasses();if(3!==a)throw"Auction ends with "+a+" passes instead of 3 passes!";for(var e=this.lastBid;null!==e&&"p"===e.getSuit();)e=e.getPreviousBid();if(null===e)throw"Unable to determine declarer!";"r"===e.getSuit()&&(d=!0,e=e.getPreviousBid());for(;null!==e&&"p"===e.getSuit();)e=e.getPreviousBid();if(null===e)throw"Unable to determine declarer!";"x"===e.getSuit()&&(d||(c=!0),e=e.getPreviousBid());if(null===e)throw"Unable to determine declarer!";
for(;null!==e&&"p"===e.getSuit();)e=e.getPreviousBid();if(null===e)throw"Unable to determine declarer!";for(var b=e.getSuit(),a=e.getLevel(),f=e.getDirection(),e=e.getPreviousBid();null!==e;){var g=e.getDirection();e.getSuit()!==b||Bridge.areOppositeDirections(g,f)||(f=g);e=e.getPreviousBid()}this.setContract(a,b,f,c,d)};Bridge.Deal.prototype.numPasses=function(){for(var a=0,b=this.lastBid;null!==b&&"p"===b.getSuit();)b=b.getPreviousBid(),a++;return a};
Bridge.Deal.prototype.addBid=function(a,b,c,d){void 0===c&&(c=null);void 0===d&&(d=null);var e=this.dealer;null!==this.lastBid&&(e=Bridge.getLHO(this.lastBid.getDirection()));if(!("r"!==b||""!==this.currentLevels.suits&&this.currentLevels.doubled&&Bridge.areOppositeDirections(e,this.currentLevels.direction)))throw"Invalid Redouble!";if("x"===b&&(""===this.currentLevels.suits||this.currentLevels.doubled||this.currentLevels.redoubled||!Bridge.areOppositeDirections(e,this.currentLevels.direction)))throw"Invalid Double!";
if("p"===b&&null!==this.lastBid&&2<this.lastBid.countPasses())throw"Invalid Pass!";if("p"!==b&&"x"!==b&&"r"!==b&&null!==this.currentLevels&&(isNaN(a)||a<this.currentLevels.level||a===this.currentLevels.level&&Bridge.BidSuitOrder.indexOf(b)>Bridge.BidSuitOrder.indexOf(this.currentLevels.suit)))throw"Invalid Bid "+a+b+"!";c=new Bridge.Bid(a,b,e,c,d);"x"===b?(this.currentLevels.doubled=!0,this.currentLevels.redoubled=!1,this.currentLevels.direction=e):"r"===b?(this.currentLevels.doubled=!1,this.currentLevels.redoubled=
!0,this.currentLevels.direction=e):"p"!==b&&(this.currentLevels.doubled=!1,this.currentLevels.redoubled=!1,this.currentLevels.direction=e,this.currentLevels.level=a,this.currentLevels.suit=b);null===this.firstBid?this.firstBid=c:(this.lastBid.setNextBid(c),c.setPreviousBid(this.lastBid));this.lastBid=c};Bridge.Deal.prototype.getLongestSuit=function(){var a=0,b;for(b in Bridge.Directions)Bridge.Directions.hasOwnProperty(b)&&(a=Math.max(a,this.hands[b].getLongestSuit()));return a};
Bridge.Deal.prototype.isDoubleAllowed=function(){if(null===this.lastBid)return!1;var a=Bridge.getLHO(this.lastBid.getDirection());return""===this.currentLevels.suits||this.currentLevels.doubled||this.currentLevels.redoubled||!Bridge.areOppositeDirections(a,this.currentLevels.direction)?!1:!0};
Bridge.Deal.prototype.isRedoubleAllowed=function(){if(null===this.lastBid)return!1;var a=Bridge.getLHO(this.lastBid.getDirection());return""!==this.currentLevels.suits&&this.currentLevels.doubled&&Bridge.areOppositeDirections(a,this.currentLevels.direction)?!0:!1};Bridge.Deal.prototype.undoAllBids=function(){this.lastBid=this.firstBid=null;this.resetCurrentLevels()};
Bridge.Deal.prototype.undoLastBid=function(){if(null!==this.lastBid){var a=this.lastBid.getPreviousBid();null===a?this.firstBid=this.lastBid=null:(this.lastBid=a,this.lastBid.setNextBid(null));this.resetCurrentLevels()}};Bridge.Deal.prototype.getCurrentLevels=function(){return this.currentLevels};
Bridge.Deal.prototype.resetCurrentLevels=function(){this.currentLevels={level:0,suit:"",direction:"",doubled:!1,redoubled:!1};for(var a=this.lastBid;null!==a;){var b=a.getSuit();if("r"===b)this.currentLevels.redoubled=!0;else if("x"===b)this.currentLevels.doubled=!0;else if("p"!==b){this.currentLevels.level=a.getLevel();this.currentLevels.suit=b;this.currentLevels.direction=a.getDirection();break}a=a.getPreviousBid()}};Bridge.Deal.prototype.setBoard=function(a){this.board=a};
Bridge.Deal.prototype.getBoard=function(){return this.board};Bridge.Deal.prototype.setDealer=function(a){a!==this.dealer&&(Bridge.checkDirection(a),this.dealer=a,this.firstBid=this.lastBid=null,this.resetCurrentLevels())};Bridge.Deal.prototype.getDealer=function(){return this.dealer};Bridge.Deal.prototype.setVulnerability=function(a){Bridge.checkVulnerability(a);this.vulnerability=a};Bridge.Deal.prototype.getVulnerability=function(){return this.vulnerability};
Bridge.Deal.prototype.setNotes=function(a){this.notes=a};Bridge.Deal.prototype.getNotes=function(){return this.notes};Bridge.Deal.prototype.setTrumpSuit=function(a){Bridge.checkBidSuit(a);this.trumpSuit=a};Bridge.Deal.prototype.areHandsValid=function(){for(var a in Bridge.Directions)if(13!==this.hands[a].getNumCards())return!1;return!0};
Bridge.Deal.prototype.isAuctionValid=function(){var a=this.lastBid;if(null===a||"p"!==a.getSuit())return!1;a=a.getPreviousBid();if(null===a||"p"!==a.getSuit())return!1;a=a.getPreviousBid();if(null===a||"p"!==a.getSuit())return!1;a=a.getPreviousBid();return null===a||"p"===a.getSuit()&&null!==a.getPreviousBid()?!1:!0};Bridge.Deal.prototype.setLeader=function(a){Bridge.checkDirection(a);this.leader=a};
Bridge.Deal.prototype.getAuctionFromContract=function(){for(var a=this.dealer,b=this.contract.declarer,c=this.contract.level,d=this.contract.trumpSuit,e=this.contract.doubled,f=this.contract.redoubled;a!==b;)this.addBid(1,"p"),a=Bridge.getLHO(a);this.addBid(c,d);e?this.addBid(c,"x"):f&&(this.addBid(c,"x"),this.addBid(c,"r"));this.addBid(c,"p");this.addBid(c,"p");this.addBid(c,"p")};
Bridge.Deal.prototype.setContract=function(a,b,c,d,e){Bridge.checkLevel(a);Bridge.checkBidSuit(b);Bridge.checkDirection(c);this.contract={level:a,trumpSuit:b,declarer:c,doubled:d,redoubled:e};this.setTrumpSuit(b);this.setLeader(Bridge.getLHO(c))};Bridge.Deal.prototype.getContract=function(){var a=this.contract.level+Bridge.getSuitName(this.contract.trumpSuit);this.contract.redoubled?a+='<font color="blue">XX</font>':this.contract.doubled&&(a+='<font color="red">X</font>');return a};
Bridge.Deal.prototype.getDeclarer=function(){return Bridge.getDirectionName(this.contract.declarer)};Bridge.Deal.prototype.addCard=function(a,b,c){Bridge.checkCardSuit(a);Bridge.checkRank(b);Bridge.checkDirection(c);var d=Bridge.Cards[a][b],e=d.getDirection();if(null!==e)throw Bridge.getSuitName(a)+Bridge.getRankName(b)+" is already assigned to "+Bridge.getDirectionName(e)+"!";this.hands[c].addCard(a,b);d.setDirection(c)};
Bridge.Deal.prototype.getSavedPlaysList=function(){var a=[],b;for(b in this.savedPlays)this.savedPlays.hasOwnProperty(b)&&a.push(b);return a};
Bridge.Deal.prototype.getPlayStrings=function(a){var b="",c,d;void 0===a&&(a=!1);if(!a||null===this.loadedPlay){if(null===this.firstPlayedCard)return"";b+="&p=";for(c=this.firstPlayedCard;null!==c;)b+=c.getSuit()+c.getRank(),d=c.getAnnotation(),null!==d&&(b+="{"+d+"}"),c=c.getNextCard()}if(a)for(var e in this.savedPlays)if(this.savedPlays.hasOwnProperty(e))for(b+="&p"+e+"=",c=this.savedPlays[e].firstPlayedCard;null!==c;)b+=c.getSuit()+c.getRank(),d=c.getAnnotation(),null!==d&&(b+="{"+d+"}"),c=c.getNextCard();
return b};Bridge.Deal.prototype.removeCard=function(a,b){var c=Bridge.Cards[a][b],d=c.getDirection();if(null===d)throw Bridge.getSuitName(a)+Bridge.getRankName(b)+" is not assigned to anyone!";this.hands[d].removeCard(a,b);c.setDirection(null)};Bridge.Deal.prototype.getHand=function(a){Bridge.checkDirection(a);return this.hands[a]};
Bridge.Deal.prototype.getSuitOrder=function(a){a=this.hands[a];for(var b=[{name:"s",color:"b",assigned:!1},{name:"h",color:"r",assigned:!1},{name:"d",color:"r",assigned:!1},{name:"c",color:"b",assigned:!1}],c={b:0,r:0},d=0;d<b.length;++d)0<a.cardCount[b[d].name]&&c[b[d].color]++;var e=[],f="";c.r>c.b?f="b":c.r<c.b&&(f="r");for(d=0;d<b.length;++d)if(!b[d].assigned&&0<a.cardCount[b[d].name]){for(c=d;b[c].color===f&&c<b.length;)c++;if(c>=b.length)break;e.push(b[c].name);b[c].assigned=!0;f=b[c].color;
c!==d&&d--}for(;d<b.length;++d)e.push(b[d].name);return e};Bridge.Deal.prototype.setName=function(a,b){Bridge.checkDirection(b);this.hands[b].setName(a)};Bridge.Deal.prototype.getNSTricks=function(){return null===this.currentPlayedCard?0:this.currentPlayedCard.getNSTricks()};Bridge.Deal.prototype.getEWTricks=function(){return null===this.currentPlayedCard?0:this.currentPlayedCard.getEWTricks()};Bridge.Deal.prototype.getName=function(a){Bridge.checkDirection(a);return this.hands[a].getName()};
Bridge.Deal.prototype.assignRest=function(){var a=null,b;for(b in Bridge.Directions)if(13>this.hands[b].getNumCards())if(null!==a){a=null;break}else a=b;if(null!==a)this.assignFourthHand(a);else for(a=0;a<Bridge.CardSuitOrder.length;++a){var c=Bridge.CardSuitOrder[a],d;for(d in Bridge.Ranks)if(Bridge.Ranks.hasOwnProperty(d)&&null===Bridge.Cards[c][d].getDirection())for(;;)if(b=Math.floor(4*Math.random()),b=Bridge.DirectionOrder[b],13>this.hands[b].getNumCards()){this.addCard(c,d,b);break}}};
Bridge.Deal.prototype.unAssignAll=function(){for(var a=0;a<Bridge.CardSuitOrder.length;++a){var b=Bridge.CardSuitOrder[a],c;for(c in Bridge.Ranks)Bridge.Ranks.hasOwnProperty(c)&&null!==Bridge.Cards[b][c].getDirection()&&this.removeCard(b,c)}};
Bridge.Deal.prototype.assignFourthHand=function(a){Bridge.checkDirection(a);for(var b=0;b<Bridge.CardSuitOrder.length;++b){var c=Bridge.CardSuitOrder[b],d;for(d in Bridge.Ranks)Bridge.Ranks.hasOwnProperty(d)&&null===Bridge.Cards[c][d].getDirection()&&this.addCard(c,d,a)}};Bridge.Deal.prototype.getCurrentBiddingTurn=function(){return null===this.lastBid?this.dealer:Bridge.getLHO(this.lastBid.getDirection())};Bridge.Deal.prototype.getNumCards=function(a){return this.hands[a].getNumCards()};
Bridge.Deal.prototype.getAuction=function(){for(var a=[],b=this.firstBid;null!==b;)a.push(b),b=b.getNextBid();return a};Bridge.Deal.prototype.getAnnotation=function(){if(null===this.currentPlayedCard)return"";var a=this.currentPlayedCard.getAnnotation();return null===a?"":unescape(a)};Bridge.Deal.prototype.setAnnotation=function(a){null!==this.currentPlayedCard&&this.currentPlayedCard.setAnnotation(a)};(function(a){"function"===typeof define&&define.amd?define(["jquery"],a):"object"===typeof exports?a(require("jquery")):a(jQuery)})(function(a){function b(a){a=e.json?JSON.stringify(a):String(a);return e.raw?a:encodeURIComponent(a)}function c(b,c){var h;if(e.raw)h=b;else a:{var k=b;0===k.indexOf('"')&&(k=k.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\"));try{k=decodeURIComponent(k.replace(d," "));h=e.json?JSON.parse(k):k;break a}catch(l){}h=void 0}return a.isFunction(c)?c(h):h}var d=/\+/g,e=
a.cookie=function(d,g,h){if(void 0!==g&&!a.isFunction(g)){h=a.extend({},e.defaults,h);if("number"===typeof h.expires){var k=h.expires,l=h.expires=new Date;l.setTime(+l+864E5*k)}return document.cookie=[e.raw?d:encodeURIComponent(d),"=",b(g),h.expires?"; expires="+h.expires.toUTCString():"",h.path?"; path="+h.path:"",h.domain?"; domain="+h.domain:"",h.secure?"; secure":""].join("")}h=d?void 0:{};for(var k=document.cookie?document.cookie.split("; "):[],l=0,m=k.length;l<m;l++){var n=k[l].split("="),p;
p=n.shift();p=e.raw?p:decodeURIComponent(p);n=n.join("=");if(d&&d===p){h=c(n,g);break}d||void 0===(n=c(n))||(h[p]=n)}return h};e.defaults={};a.removeCookie=function(b,c){if(void 0===a.cookie(b))return!1;a.cookie(b,"",a.extend({},c,{expires:-1}));return!a.cookie(b)}});(function(a,b,c){function d(a){a=a||location.href;return"#"+a.replace(/^[^#]*#?(.*)$/,"$1")}var e=document,f,g=a.event.special,h=e.documentMode,k="onhashchange"in b&&(h===c||7<h);a.fn.hashchange=function(a){return a?this.bind("hashchange",a):this.trigger("hashchange")};a.fn.hashchange.delay=50;g.hashchange=a.extend(g.hashchange,{setup:function(){if(k)return!1;a(f.start)},teardown:function(){if(k)return!1;a(f.stop)}});f=function(){function f(){var c=d(),e=s(p);c!==p?(r(p=c,e),a(b).trigger("hashchange")):
e!==p&&(location.href=location.href.replace(/#.*/,"")+e);g=setTimeout(f,a.fn.hashchange.delay)}var h={},g,p=d(),q=function(a){return a},r=q,s=q;h.start=function(){g||f()};h.stop=function(){g&&clearTimeout(g);g=c};a.browser.msie&&!k&&function(){var b,c;h.start=function(){b||(c=(c=a.fn.hashchange.src)&&c+d(),b=a('<iframe tabindex="-1" title="empty"/>').hide().one("load",function(){c||r(d());f()}).attr("src",c||"javascript:0").insertAfter("body")[0].contentWindow,e.onpropertychange=function(){try{"title"===
event.propertyName&&(b.document.title=e.title)}catch(a){}})};h.stop=q;s=function(){return d(b.location.href)};r=function(c,d){var f=b.document,h=a.fn.hashchange.domain;c!==d&&(f.title=e.title,f.open(),h&&f.write('<script>document.domain="'+h+'"\x3c/script>'),f.close(),b.location.hash=c)}}();return h}()})(jQuery,this);var BHP={HA:{},AA:{},PA:{},cardImageDimensions:{folder:"images/cards/small",width:76,height:92,cardBackImage:"images/cards/small/b1fv.png",percentageWidthShowing:0.5,percentageHeightShowing:0.5},OptionSet:{bootstrapClass:{id:"bootstrap-class",value:"success",type:"select",label:"Base Color for Elements on Page",values:[{name:"Success (Usually Green)",value:"success"},{name:"Info (Usually Blue)",value:"info"},{name:"Warning (Usually Orange)",value:"warning"},{name:"Danger (Usually Red)",value:"danger"}]},
alternateSuitColor:{id:"alternate-suit-color",value:!0,type:"checkbox",label:"Try to Alternate Suit Colors in Horizontal Layout"},useIconsOnly:{id:"use-icons-only",value:!1,type:"checkbox",label:"Use Icons only in Footer Bar"},animateCards:{id:"animate-cards",value:!0,type:"checkbox",label:"Animate Cards when playing to the Table"}},bootswatchThemes:{},gutter:5,fontSize:12,manualHashChange:!0,savePlayCount:0,state:"load",contractString:null,getQueryString:function(a){var b=a.indexOf("?");return-1===
b||b===a.length-1?null:a.slice(b+1)},readQueryParameters:function(){BHP.queryParameters=null;var a,b,c=BHP.getQueryString(document.URL);if(void 0!==c&&null!==c&&c&&(a=[],c=c.split("#")[0],c=c.trim()))for(var c=c.split("&"),d=0;d<c.length;d++)b=c[d].split("="),a.push(b[1]),a[b[0]]=b[1];BHP.queryParameters=a},getParameterValue:function(a,b){return void 0!==a[b]?a[b]:void 0!==a[b.toUpperCase()]?a[b.toUpperCase()]:null},loadDealInformation:function(){if(BHP.queryParameters){var a=BHP.getParameterValue(BHP.queryParameters,
"b");a&&BHP.deal.setBoard(a);if(a=BHP.getParameterValue(BHP.queryParameters,"d"))try{BHP.deal.setDealer(a)}catch(b){BHP.addError(b)}if(a=BHP.getParameterValue(BHP.queryParameters,"v"))try{BHP.deal.setVulnerability(a)}catch(c){BHP.addError(c)}if(a=BHP.getParameterValue(BHP.queryParameters,"t"))try{BHP.deal.setNotes(a)}catch(d){BHP.addError(d)}}},loadNames:function(){if(BHP.queryParameters)for(var a in Bridge.Directions)if(Bridge.Directions.hasOwnProperty(a)){var b=BHP.getParameterValue(BHP.queryParameters,
a+"n");b&&BHP.deal.setName(b,a)}},loadHands:function(){if(!BHP.queryParameters)return!1;var a=[];try{for(var b in Bridge.Directions)if(Bridge.Directions.hasOwnProperty(b)){var c=BHP.getParameterValue(BHP.queryParameters,b);c?BHP.loadHand(b,c):a.push(b)}if(1===a.length){BHP.deal.assignFourthHand(a[0]);for(var d in Bridge.Directions)if(Bridge.Directions.hasOwnProperty(d)){var e=BHP.deal.getNumCards(d);13!==e&&BHP.addError(Bridge.getDirectionName(d)+" has "+e+"!")}}else if(1<a.length){b=[];for(c=0;c<
a.length;++c)b.push(Bridge.getDirectionName(a[c]));var f=b.join(" and ");BHP.addError(f+" hands have not been specified!")}}catch(g){BHP.addError(g)}return 1>BHP.errors.length},loadHand:function(a,b){b=b.toLowerCase();for(var c=Bridge.getDirectionName(a),d="",e="",f=0;f<b.length;++f){var e="In hand for "+c+" at position "+(f+1)+" - ",g=b.charAt(f);switch(g){case "c":case "d":case "h":case "s":d=g;break;case "1":if(""===d){BHP.addError(e+g+" was found when a suit was expected!");continue}if(f<b.length-
1&&"0"===b.charAt(f+1)){e="t";f++;try{BHP.deal.addCard(d,e,a)}catch(h){BHP.addError(h)}}else{BHP.addError(e+"a 1 is present without a subsequent 0. Use 10 or t to reprensent the ten.");continue}break;default:if(""===d){BHP.addError(e+g+" was found when a suit was expected!");continue}e=g;try{BHP.deal.addCard(d,e,a)}catch(k){BHP.addError(k)}}}},loadContract:function(a){BHP.contractString=a;var b,c,d,e,f=parseInt(a.charAt(1));if(isNaN(f)){b=a.charAt(1);d=c=!1;e=a.charAt(2);if("d"===e||"x"===e||"r"===
e)d="r"===e,c=!d,e=a.charAt(3);e=Bridge.getRHO(e);f=1}else if(b=a.charAt(2),e=a.charAt(3),d=c=!1,"d"===e||"x"===e||"r"===e)d="r"===e,c=!d,e=a.charAt(4);try{BHP.deal.setContract(f,b,e,c,d),BHP.deal.getAuctionFromContract()}catch(g){return BHP.addError(g),!1}return!0},parseAnnotation:function(a,b,c){void 0===c&&(c="}");c=a.indexOf(c,b+1);return-1===c?null:{annotation:a.slice(b+1,c),endBracePosition:c}},loadAuction:function(){if(!BHP.queryParameters)return!1;var a=BHP.getParameterValue(BHP.queryParameters,
"a");if(!a)return BHP.addError("No auction or contract or trumps and leader has been specified!"),!1;var b=a,a=a.toLowerCase();if("-"!==a.charAt(0)){try{for(var c=0;c<a.length;++c){var d="In auction specified at position "+(c+1)+" - ",e=a.charAt(c),f=1,g="",h=null,k=null;"d"===e||"x"===e?g="x":"p"===e||"r"===e?g=e:(f=parseInt(e),c++,g=a.charAt(c));var l=a.charAt(c+1),m="",n="";if("("===l||"{"===l){m="("===l?")":"}";n=BHP.parseAnnotation(b,c+1,m);if(!n)return BHP.addError(d+" No closing ) found!"),
!1;"("===l?k=n.annotation:h=n.annotation;c=n.endBracePosition}l=a.charAt(c+1);if("("===l||"{"===l){m="("===l?")":"}";n=BHP.parseAnnotation(b,c+1,m);if(!n)return BHP.addError(d+" No closing ) found!"),!1;"("===l?k=n.annotation:h=n.annotation;c=n.endBracePosition}BHP.deal.addBid(f,g,k,h)}}catch(p){BHP.addError(p)}BHP.deal.isAuctionValid()&&BHP.deal.determineDeclarer();return 1>BHP.errors.length}return BHP.loadContract(a)},drawAuction:function(a,b){void 0===b&&(b="");var c=BHP.deal.getAuction();$(a).empty();
if(0<c.length){var d;d='<table id="auction-table" class="'+b+' table table-bordered table-condensed table-striped"><tbody>';d+='<tr class="'+BHP.getOption("bootstrapClass")+'"><th class="text-center">W</th><th class="text-center">N</th><th class="text-center">E</th><th class="text-center">S</th></tr>';var e=c[0],f="w";d+='<tr class="text-center">';for(var g=0;e.direction!==f;)d+="<td>-</td>",g++,"s"===f&&(d+="</tr>"),f=Bridge.getLHO(f);for(e=0;e<c.length;++e){g=c[e];if(g.direction!==f){alert("Something went wrong in setting up auction!");
return}"w"===g.direction&&(d+='<tr class="text-center">');var g=g.getString(),h="",h=null!==g.explanation&&g.explanation.trim()?'<span id="bid-'+e+'" data-toggle="tooltip" class="cursor-pointer bg-'+BHP.getOption("bootstrapClass")+' bid-annotation" title="'+unescape(g.explanation)+'">'+g.bid+"</span>":'<span title="Click to add explanation/description" class="bid-annotation cursor-pointer" id="bid-'+e+'">'+g.bid+"</span>";d+='<td class="annotatable-bid" bidnumber="'+e+'">'+h+"</td>";"s"===f&&(d+=
"</tr>");f=Bridge.getLHO(f)}for(;"w"!==f;)d+="<td></td>","s"===f&&(d+="</tr>"),f=Bridge.getLHO(f);d+="</tbody></table>";$(a).append(d);$(".annotatable-bid").click(function(){BHP.editBidExplanation(this)})}$(".bid-annotation").tooltip({placement:"bottom",container:"body"})},setVulnerability:function(a){var b=$("#compass-area");b.removeClass("ns-vulnerable").removeClass("ew-vulnerable");"n"!==a&&"b"!==a||b.addClass("ns-vulnerable");"e"!==a&&"b"!==a||b.addClass("ew-vulnerable")},drawDealInformation:function(){var a=
BHP.deal.getVulnerability();BHP.setVulnerability(a);var a='<table id="deal-information-table" class="table table-bordered table-condensed table-striped">'+('<thead><tr class="'+BHP.getOption("bootstrapClass")+'"><th class="middle" colspan="2">Deal Information</th></tr></thead>'),a=a+"<tbody>",b=BHP.deal.getBoard();null===b&&(b=1);var a=a+'<tr><td class="right">Board</td><td>'+('<span id="board" class="cursor-pointer label label-'+BHP.getOption("bootstrapClass")+'">'+b+"</span>"),a=a+"</td></tr>",
a=a+'<tr><td class="right">Contract</td><td>',b=BHP.deal.getContract(),c=BHP.deal.getDeclarer();null!==c&&(b+=" by "+c);a+='<span id="contract" class="label label-default">'+b+"</span>";a+="</td></tr>";a+='<tr><td class="right">NS Tricks</td><td>';a+='<span id="ns-tricks" class="label label-default">0</span>';a+="</td></tr>";a+='<tr><td class="right">EW Tricks</td><td>';a+='<span id="ew-tricks" class="label label-default">0</span>';a+="</td></tr>";a+="</tbody></table>";$("#deal-information").append(a);
b=$("#board");b.click(BHP.changeBoardDialog);b.attr("title","Click to change Board Number");b.tooltip({placement:"bottom",container:"body"});a=BHP.deal.getNotes();null===a&&(a="Untitled");b=$("#general-messages");b.empty().append(unescape(a));b.addClass("alert");b.addClass("alert-"+BHP.getOption("bootstrapClass"));b.addClass("cursor-pointer");b.click(BHP.changeNotesDialog);b.attr("title","Click to change Title/Notes");b.tooltip({placement:"bottom",container:"body"})},changeNotesDialog:function(){var a=
BHP.deal.getNotes();null===a&&(a="Untitled");$("#modal-popup-save-content").val(unescape(a));BHP.showModalSaveDialog("Change Title/Notes",BHP.saveNotes)},saveNotes:function(){var a=$("#modal-popup-save-content").val();BHP.deal.setNotes(a);$("#general-messages").html(a);BHP.hideModalSaveDialog()},changeBoardDialog:function(){var a=BHP.deal.getBoard();null===a&&(a=1);$("#modal-popup-save-content").val(a);BHP.showModalSaveDialog("Change Board Number",BHP.saveBoard)},saveBoard:function(){var a=$("#modal-popup-save-content").val();
BHP.deal.setBoard(a);$("#board").html(a);BHP.hideModalSaveDialog()},addError:function(a){BHP.errors.push(a)},showErrors:function(){$("#section").addClass("padding-top");var a;a='<div class="container"><h1>Errors Found as noted below</h1><ol class="list-group"><li class="list-group-item list-group-item-warning"><span class="item">'+BHP.errors.join('</span></li><li class="list-group-item list-group-item-warning"><span class="item">');a+="</span></li></ol>";a+="</div>";$("#section").empty().append(a);
a='<div id="postamble"></div>';$("#section").append(a);$("#postamble").load("instructions.html")},drawFooter:function(){$("#footer-menu-bar").remove();var a='<div id="footer-menu-bar" class="fixed btn-toolbar" role="toolbar"></div>';$("body").append(a);BHP.footer=$("#footer-menu-bar");a={"edit-hands":{name:"Edit Hands",icon:"wrench",iconAfter:!1},"edit-auction":{name:"Edit Auction",icon:"heart-empty",iconAfter:!1}};a=BHP.getButtonGroupHTML("edit-functions",a);BHP.footer.append(a);a={rewind:{name:"Rewind",
icon:"step-backward",iconAfter:!1},"undo-trick":{name:"Undo Previous Trick",icon:"backward",iconAfter:!1},"undo-play":{name:"Undo Previous Play",icon:"chevron-left",iconAfter:!1},"redo-play":{name:"Redo Next Play",icon:"chevron-right",iconAfter:!0},"redo-trick":{name:"Redo Next Trick",icon:"forward",iconAfter:!0},"fast-forward":{name:"Fast Forward",icon:"step-forward",iconAfter:!0}};a=BHP.getButtonGroupHTML("controls",a);BHP.footer.append(a);var a='<div class="btn-group btn-group-sm dropup">',b=BHP.getOption("useIconsOnly")?
"":'<span class="text-highlight">Save Play</span>',a=a+('<button title = "Save Play " id="save-play" type="button" class="toolbar btn btn-'+BHP.getOption("bootstrapClass")+'"><span class="glyphicon glyphicon-floppy-save"></span> '+b+"</button>"),b=BHP.getOption("useIconsOnly")?"":'<span class="text-highlight">Load Play</span>',a=a+('<button title="Load Play" type="button" class="toolbar btn btn-'+BHP.getOption("bootstrapClass")+' dropdown-toggle" data-toggle="dropdown"><span class="glyphicon glyphicon-floppy-open"></span> '+
b+' <span class="caret"></span></button>'),a=a+'<ul id="lines" class="dropdown-menu" role="menu"></ul>',a=a+"</div>",a=a+"</div>";BHP.footer.append(a);a=BHP.viewport.width/2-BHP.footer.width()/2;BHP.footer.css({left:a,bottom:0});$("#edit-hands").click(function(){$(this).tooltip("hide");BHP.handleHands(!0)});$("#edit-auction").click(function(){$(this).tooltip("hide");BHP.handleAuction(!0)});$("#undo-play").click(function(){BHP.undoCard();BHP.setHash()});$("#redo-play").click(function(){BHP.redoCard();
BHP.setHash()});$("#undo-trick").click(function(){BHP.undoTrick();BHP.setHash()});$("#redo-trick").click(function(){BHP.redoTrick();BHP.setHash()});$("#rewind").click(function(){BHP.rewind();BHP.setHash()});$("#fast-forward").click(function(){BHP.fastForward();BHP.setHash()});BHP.loadSavedPlaysList();$("#save-play").click(function(){BHP.showModalSaveDialog("Save Current Play",BHP.savePlay)});$(".toolbar").tooltip({placement:"top",container:"body"})},updateAnnotation:function(){$("#annotation-area").html(BHP.deal.getAnnotation())},
rewind:function(){for(BHP.undoCard();!BHP.deal.isAtBeginning();)BHP.undoCard()},undoTrick:function(){for(BHP.undoCard();!BHP.deal.isAtBeginning()&&!BHP.deal.isEndOfTrick();)BHP.undoCard()},fastForward:function(){for(BHP.redoCard();!BHP.deal.isAtEnd();)BHP.redoCard()},redoTrick:function(){for(BHP.redoCard();!BHP.deal.isAtEnd()&&!BHP.deal.isEndOfTrick();)BHP.redoCard()},redoCard:function(){var a=BHP.deal.redoCard();if(null!==a){var a="#"+BHP.getCardID(a.suit,a.rank),b=$(a);b.attr("status","played");
b.removeClass("cursor-pointer").addClass("cursor-not-allowed");b.attr("src",BHP.cardImageDimensions.cardBackImage);BHP.deal.isNewTrick()&&BHP.clearTableCards();BHP.playTableCard($(a));BHP.setPlayableCards()}},undoCard:function(){var a=BHP.deal.undoCard();if(null!==a){var b="#card-"+a.suit+a.rank;$(b).attr("src",$(b).attr("imageName"));$(b).attr("status","not-played");$("#"+(a.direction+"-played-card")).empty();if(BHP.deal.isEndOfTrick())for(a=BHP.deal.getTableCards(),b=0;b<a.length;++b){var c=a[b],
c="#"+BHP.getCardID(c.suit,c.rank);BHP.playTableCard($(c))}BHP.setPlayableCards()}},getCardID:function(a,b){return"card-"+a+b},showCard:function(a,b,c,d,e,f,g,h){var k=BHP.getCardID(b,c),l=BHP.cardImageDimensions.folder+"/"+b+c+".png";$(a).append('<img id="'+k+'" class="fixed card"></img>');a=$("#"+k);a.attr("src",l);a.attr("imageName",l);a.attr("status","not-played");a.attr("suit",b);a.attr("rank",c);a.attr("direction",d);a.css({width:g,height:h,top:e,left:f})},drawHands:function(){BHP.getHands();
BHP.computeScalingFactor();for(var a in Bridge.Directions)Bridge.Directions.hasOwnProperty(a)&&("horizontal"===BHP.hands[a].layout?BHP.drawHorizontal(a):BHP.drawVertical(a));$(".change-name").click(function(){var a=$(this).attr("direction");BHP.changeNameDialog(a)});BHP.setPlayableCards()},drawNames:function(a,b,c){var d=BHP.deal.getName(a);null===d&&(d=Bridge.getDirectionName(a));var e=a+"-name",d='<span direction="'+a+'" id="'+e+'"  class="cursor-pointer change-name text-size fixed label label-'+
BHP.getOption("bootstrapClass")+'">'+d+"</span>";$("#"+a+"-hand").append(d);a=$("#"+e);a.css({top:b-a.outerHeight(),left:c});a.attr("title","Click to change Name").tooltip({container:"body"})},playTableCard:function(a){var b=a.attr("direction"),c=b+"-played-card",d="played-"+a.attr("id"),e='<img class="fixed" id="'+d+'" src="'+a.attr("imageName")+'"></img>';$("#"+c).empty().append(e);d=$("#"+d);d.width(a.width());d.height(a.height());d.attr("suit",a.attr("suit"));d.attr("rank",a.attr("rank"));d.attr("direction",
b);d.attr("title","Click to add play annotation");BHP.getOption("animateCards")&&(a=a.position(),c=$("#"+c).position(),d.css({top:a.top,left:a.left}),d.animate({top:c.top,left:c.left},300,function(){}));d.click(function(){BHP.editAnnotation(this)})},editBidExplanation:function(a){a=$(a).attr("bidnumber");a=parseInt(a);var b=BHP.deal.getExplanationForBid(a);null===b&&(b="");$("#modal-popup-save-content").val(b).attr("bidnumber",a);BHP.showModalSaveDialog("Edit/Add Explanation for Bid",BHP.saveBidExplanation)},
editBidAnnotation:function(a){a=$(a).attr("bidnumber");a=parseInt(a);var b=BHP.deal.getAnnotationForBid(a);null===b&&(b="");$("#modal-popup-save-content").val(b).attr("bidnumber",a);BHP.showModalSaveDialog("Edit/Add Annotation for Bid",BHP.saveBidAnnotation)},editAnnotation:function(a){var b=$(a).attr("suit");a=$(a).attr("rank");var c,d;void 0!==b?(c="Edit/Add Annotation for "+Bridge.getSuitName(b)+Bridge.getRankName(a),d=BHP.deal.getAnnotationForCard(b,a)):(c="Edit/Add Annotation for last played card",
d=BHP.deal.getAnnotation());null===d&&(d="");$("#modal-popup-save-content").val(d).attr("suit",b).attr("rank",a);BHP.showModalSaveDialog(c,BHP.savePlayAnnotation)},cardClicked:function(a){var b=$(a),c=b.attr("suit"),d=b.attr("rank"),e=b.attr("direction");BHP.deal.playCard(c,d,e);b.attr("status","played");b.addClass("cursor-not-allowed");b.attr("src",BHP.cardImageDimensions.cardBackImage);BHP.deal.isNewTrick()&&BHP.clearTableCards();BHP.playTableCard($(a));BHP.setPlayableCards();BHP.setHash()},setActiveHand:function(a){for(var b in Bridge.Directions)if(Bridge.Directions.hasOwnProperty(b)){var c=
$("#"+(b+"-name"));b===a?c.removeClass("label-"+BHP.getOption("bootstrapClass")).addClass("label-primary"):c.addClass("label-"+BHP.getOption("bootstrapClass")).removeClass("label-primary")}},updateButtonStatus:function(){var a=BHP.deal.isAtBeginning();$("#rewind").attr("disabled",a);$("#undo-trick").attr("disabled",a);$("#undo-play").attr("disabled",a);a=BHP.deal.isAtEnd();$("#redo-trick").attr("disabled",a);$("#redo-play").attr("disabled",a);$("#fast-forward").attr("disabled",a)},setPlayableCards:function(){$(".card").unbind("click").removeClass("img-highlight").removeClass("cursor-pointer").addClass("cursor-not-allowed").tooltip("destroy");
var a=BHP.deal.getNextToPlay(),b="[direction="+a+'][status="not-played"]',c=BHP.deal.getSuitLed();null!==c&&(c=b+'[suit="'+c+'"]',0<$(c).length&&(b=c));$(b).addClass("img-highlight").removeClass("cursor-not-allowed").addClass("cursor-pointer");$(b).attr("title","Click to Play Card").tooltip();$(b).click(function(){BHP.cardClicked(this)});BHP.setActiveHand(a);BHP.updateButtonStatus();BHP.updateAnnotation();$("#ns-tricks").html(BHP.deal.getNSTricks());$("#ew-tricks").html(BHP.deal.getEWTricks())},drawHorizontal:function(a){var b=
"#"+a+"-hand";$(b).empty();var c=BHP.cardImageDimensions.width*BHP.scalingFactor,d=BHP.cardImageDimensions.height*BHP.scalingFactor,e=12*c*BHP.cardImageDimensions.percentageWidthShowing+c,f=$(b).position().top+$(b).outerHeight()/2-d/2,e=$(b).position().left+$(b).outerWidth()/2-e/2;BHP.drawNames(a,f,e);for(var g=BHP.getOption("alternateSuitColor")?BHP.deal.getSuitOrder(a):Bridge.CardSuitOrder,h=0;h<g.length;++h){var k=g[h],l=BHP.hands[a].cards[k];if(0<l.length)for(var m=0;m<l.length;++m)BHP.showCard(b,
k,l[m],a,f,e,c,d),e+=c*BHP.cardImageDimensions.percentageWidthShowing}},drawVertical:function(a){var b="#"+a+"-hand";$(b).empty();var c=BHP.cardImageDimensions.width*BHP.scalingFactor,d=BHP.cardImageDimensions.height*BHP.scalingFactor,e=3*d*BHP.cardImageDimensions.percentageHeightShowing+d,f=(BHP.hands[a].longest-1)*c*BHP.cardImageDimensions.percentageWidthShowing+c,e=$(b).position().top+$(b).outerHeight()/2-e/2,f=$(b).position().left+$(b).outerWidth()/2-f/2;BHP.drawNames(a,e,f);for(var g=0;g<Bridge.CardSuitOrder.length;++g){for(var h=
f,k=Bridge.CardSuitOrder[g],l=BHP.hands[a].cards[k],m=0;m<l.length;++m)BHP.showCard(b,k,l[m],a,e,h,c,d),h+=c*BHP.cardImageDimensions.percentageWidthShowing;e+=d*BHP.cardImageDimensions.percentageHeightShowing}},getHorizontalWidth:function(a){a=BHP.hands[a];for(var b=0,c=0;c<Bridge.CardSuitOrder.length;++c){var d=Bridge.CardSuitOrder[c];0<a.cards[d].length&&(b+=(a.cards[d].length-1)*BHP.cardImageDimensions.width*BHP.cardImageDimensions.percentageWidthShowing+BHP.cardImageDimensions.width)}return b},
getVerticalWidth:function(a){return(BHP.hands[a].longest-1)*BHP.cardImageDimensions.width*BHP.cardImageDimensions.percentageWidthShowing+BHP.cardImageDimensions.width},getHorizontalHeight:function(a){return BHP.cardImageDimensions.height},getVerticalHeight:function(a){return 3*BHP.cardImageDimensions.height*BHP.cardImageDimensions.percentageHeightShowing+BHP.cardImageDimensions.height},getHands:function(){BHP.hands={};for(var a in Bridge.Directions)if(Bridge.Directions.hasOwnProperty(a)){var b=BHP.deal.getHand(a);
BHP.hands[a]={};BHP.hands[a].count={};BHP.hands[a].cards={};for(var c=0;c<Bridge.CardSuitOrder.length;++c){var d=Bridge.CardSuitOrder[c];BHP.hands[a].cards[d]=[];for(var e=BHP.hands[a].count[d]=0;e<Bridge.RankOrder.length;++e){var f=Bridge.RankOrder[e];f in b.cards[d]&&(BHP.hands[a].count[d]++,BHP.hands[a].cards[d].push(f))}}BHP.hands[a].longest=Math.max(BHP.hands[a].count.s,BHP.hands[a].count.h,BHP.hands[a].count.d,BHP.hands[a].count.c);BHP.calculateHandDimensionsAndLayout(a)}},calculateHandDimensionsAndLayout:function(a){var b=
BHP.hands[a],c="#"+a+"-hand",d=$(c).outerWidth()-2*BHP.gutter,e=$(c).outerHeight()-2*BHP.gutter,c=BHP.getHorizontalWidth(a),f=BHP.getHorizontalHeight(a),g=Math.min(d/c,e/f),h=BHP.getVerticalWidth(a);a=BHP.getVerticalHeight(a);d=Math.min(d/h,e/a);g<d?(b.height=a,b.width=h,b.layout="vertical"):(b.height=f,b.width=c,b.layout="horizontal")},computeScalingFactor:function(){BHP.scalingFactor=100;for(var a in Bridge.Directions)if(Bridge.Directions.hasOwnProperty(a)){var b="#"+a+"-hand",c=BHP.hands[a],d=
$(b).outerWidth()-2*BHP.gutter,b=$(b).outerHeight()-2*BHP.gutter;BHP.scalingFactor=Math.min(BHP.scalingFactor,d/c.width,b/c.height)}a="<style>"+("table.play {font-size: "+BHP.fontSize*BHP.scalingFactor+"px;}");a+=".text-size {font-size: "+BHP.fontSize*BHP.scalingFactor+"px;}";$(a+"</style>").appendTo("head")},changeVulnerabilityDialog:function(){var a=BHP.deal.getVulnerability();null===a&&(a="-");var b,c={"-":"",n:"resize-vertical",e:"resize-horizontal",b:"plus"};b='<div id="vulnerability" class="btn-group btn-group-sm">';
for(var d in c)if(c.hasOwnProperty(d)){var e="vulnerability-"+d,f="btn-default";a===d&&(f="btn-"+BHP.getOption("bootstrapClass"));b+='<button type="button" id="'+e+'" vulnerability="'+d+'" class="change-vulnerability btn '+f+'">';b+='<span class="glyphicon glyphicon-'+c[d]+'"></span>';b+=Bridge.getVulnerabilityName(d);b+="</button>"}b+="</div>";$("#modal-popup-confirm-content").attr("vulnerability",a);BHP.showModalConfirmDialog("Change Vulnerability",b,BHP.saveVulnerability,"vulnerability")},saveVulnerability:function(){var a=
$("#modal-popup-confirm-content").attr("vulnerability");BHP.deal.setVulnerability(a);BHP.setVulnerability(a);BHP.hideModalConfirmDialog()},drawPlayingTable:function(){var a=$("#playing-table");a.addClass("card-table");a.append('<img id="compass-area" class="fixed"></img>');var b=$("#compass-area");b.attr("src","images/compass.png");b.addClass("cursor-pointer");b.attr("title","Click to change vulnerability");b.tooltip();var c=0.15*a.outerWidth(),d=c,e=a.position().top+a.outerHeight()/2-d/2,f=a.position().left+
a.outerWidth()/2-c/2,c={width:c,height:d,top:e,left:f};b.click(BHP.changeVulnerabilityDialog);b.css(c);b="n-played-card";a.append('<div id="'+b+'" class="fixed"></div>');b=$("#"+b);e=a.position().top;f=a.position().left+a.outerWidth()/2-BHP.cardImageDimensions.width*BHP.scalingFactor/2;c=BHP.cardImageDimensions.width*BHP.scalingFactor;d=BHP.cardImageDimensions.height*BHP.scalingFactor;b.css({left:f,top:e,width:c,height:d,zIndex:10});b="e-played-card";a.append('<div id="'+b+'" class="fixed"></div>');
b=$("#"+b);e=a.position().top+a.outerHeight()/2-BHP.cardImageDimensions.height*BHP.scalingFactor/2;c=BHP.cardImageDimensions.width*BHP.scalingFactor;d=BHP.cardImageDimensions.height*BHP.scalingFactor;f=a.position().left+a.outerWidth()-c;b.css({left:f,top:e,width:c,height:d,zIndex:10});b.attr("z-index",10);b="s-played-card";a.append('<div id="'+b+'" class="fixed"></div>');b=$("#"+b);f=a.position().left+a.outerWidth()/2-BHP.cardImageDimensions.width*BHP.scalingFactor/2;c=BHP.cardImageDimensions.width*
BHP.scalingFactor;d=BHP.cardImageDimensions.height*BHP.scalingFactor;e=a.position().top+a.outerHeight()-d;b.css({left:f,top:e,width:c,height:d,zIndex:10});b.attr("z-index",10);b="w-played-card";a.append('<div id="'+b+'" class="fixed"></div>');b=$("#"+b);e=a.position().top+a.outerHeight()/2-BHP.cardImageDimensions.height*BHP.scalingFactor/2;f=a.position().left;c=BHP.cardImageDimensions.width*BHP.scalingFactor;d=BHP.cardImageDimensions.height*BHP.scalingFactor;b.css({left:f,top:e,width:c,height:d,zIndex:10});
b.attr("z-index",10);BHP.clearTableCards()},clearTableCards:function(){for(var a in Bridge.Directions)Bridge.Directions.hasOwnProperty(a)&&$("#"+(a+"-played-card")).empty()},drawMainSection:function(){var a=[{id:"general-messages",name:"Cell 0 0",height:3,width:3,cellClass:"status",left:0,top:0,widthGutters:1,heightGutters:1},{id:"n-hand",name:"Cell 0 0",height:3,width:6,cellClass:"",left:3,top:0,widthGutters:2,heightGutters:1},{id:"auction",name:"Cell 0 0",height:3,width:3,cellClass:"status",left:9,
top:0,widthGutters:3,heightGutters:1},{id:"w-hand",name:"Cell 0 0",height:6,width:4,cellClass:"",left:0,top:3,widthGutters:1,heightGutters:2},{id:"playing-table",name:"Cell 0 0",height:6,width:4,cellClass:"",left:4,top:3,widthGutters:2,heightGutters:2},{id:"e-hand",name:"Cell 0 0",height:6,width:4,cellClass:"",left:8,top:3,widthGutters:3,heightGutters:2},{id:"deal-information",name:"Cell 0 0",height:3,width:3,cellClass:"status",left:0,top:9,widthGutters:1,heightGutters:3},{id:"s-hand",name:"Cell 0 0",
height:3,width:6,cellClass:"",left:3,top:9,widthGutters:2,heightGutters:3},{id:"annotation-area",name:"Cell 0 0",height:3,width:3,cellClass:"status alert alert-"+BHP.getOption("bootstrapClass"),left:9,top:9,widthGutters:3,heightGutters:3}];BHP.header=$("#header");for(var b=(BHP.footer.position().top-BHP.header.position().top-BHP.header.height()-4*BHP.gutter)/12,c=(BHP.viewport.width-4*BHP.gutter)/12,d=BHP.header.position().top+BHP.header.height(),e=0;e<a.length;++e){var f=a[e],g=d+f.heightGutters*
BHP.gutter+f.top*b,h=0+f.widthGutters*BHP.gutter+f.left*c,k=f.height*b,l=f.width*c,m='<div id="'+f.id+'" class="'+f.cellClass+' fixed"></div>';$("#section").append(m);f=$("#"+f.id);f.css({top:g,left:h,width:l,height:k})}BHP.adjustCardTable();$("#annotation-area").addClass("cursor-pointer").attr("title","Click to add play annotation").tooltip({placement:"top",container:"body"});$("#annotation-area").click(function(){BHP.deal.isAtBeginning()?BHP.showModalDialog("No Play Made Yet!","<h4>There is no card played to the table yet and so a play annotation cannot be added!</h4>"):
BHP.editAnnotation(this)})},adjustCardTable:function(){var a=$("#playing-table"),b=a.outerWidth(),c=a.outerHeight(),d=a.position().top,e=a.position().left,f=0,g;if(b>c)f=(b-c)/2,b=g=c,e+=f,c=$("#w-hand"),c.css({width:c.outerWidth()+f}),c=$("#e-hand"),c.css({left:c.position().left-f,width:c.outerWidth()+f});else if(c>b)f=(c-b)/2,g=b,d+=f,c=$("#n-hand"),c.css({height:c.outerHeight()+f}),c=$("#s-hand"),c.css({top:c.position().top-f,height:c.outerHeight()+f});else return;a.css({top:d,left:e,width:g,height:b})},
drawTitles:function(){$("#section").append('<span id="annotation-area-title"  class="text-size fixed label label-default">Play Annotations</span>');var a=$("#annotation-area-title");a.css({top:$("#annotation-area").position().top-a.outerHeight(),left:$("#annotation-area").position().left})},drawAll:function(){BHP.viewport={width:$(window).width(),height:$(window).height()};$("#show-instructions").unbind("click");$("#show-instructions").click(BHP.PA.showInstructions);$("#header-title").html("Play Hand");
$("#section").empty();BHP.drawFooter();BHP.drawMainSection();BHP.drawHands();BHP.drawPlayingTable();BHP.drawAuction("#auction","play1");BHP.drawDealInformation();BHP.drawTitles();BHP.deal.resetPlayedCardIndex();BHP.manualHashChange=!1;BHP.processHash();$(window).unbind("hashchange");$(window).hashchange(function(){BHP.processHash()})},savePlayAnnotation:function(){var a=$("#modal-popup-save-content"),b=a.attr("suit"),c=a.attr("rank"),a=a.val();void 0===b?BHP.deal.setAnnotation(a):BHP.deal.setAnnotationForCard(b,
c,a);BHP.updateAnnotation();BHP.hideModalSaveDialog()},saveBidExplanation:function(){var a=$("#modal-popup-save-content"),b=a.attr("bidnumber");void 0!==b&&(b=parseInt(b),a=a.val(),BHP.deal.setExplanationForBid(b,a),BHP.drawAuction("#auction"));BHP.hideModalSaveDialog()},saveBidAnnotation:function(){var a=$("#modal-popup-save-content"),b=a.attr("bidnumber");void 0!==b&&(b=parseInt(b),a=a.val(),BHP.deal.setAnnotationForBid(b,a),BHP.drawAuction("#auction"));BHP.hideModalSaveDialog()},makeIdentifier:function(a){a=
a.trim().replace(/[^a-zA-Z0-9]+/g,"_");return a.toLowerCase()},savePlay:function(){var a=$("#modal-popup-save-content").val();if(a){a=unescape(a);try{BHP.deal.savePlay(a)}catch(b){alert(b);return}BHP.hideModalSaveDialog();var c=$("#lines"),d=BHP.makeIdentifier(a);c.append('<li><a class="btn" id="'+d+'">'+a+"</a></li>");$("#"+d).click(function(){BHP.loadSavedPlay(this)})}else alert("Play name cannot be empty!")},loadPlayByName:function(a,b){BHP.deal.resetAll();for(var c=a.toLowerCase(),d=0;d<c.length;++d){var e=
null,f=c.charAt(d);Bridge.checkCardSuit(f);d++;var g="In play "+b+" at position "+(d+1)+" - ";if(d>=c.length)throw g+" No rank has been specified for suit "+f;var h=c.charAt(d);Bridge.checkRank(h);if("{"===c.charAt(d+1)){d=BHP.parseAnnotation(a,d+1);if(!d)throw g+" No closing } found!";e=d.annotation;d=d.endBracePosition}BHP.deal.playCard(f,h,null,e)}BHP.deal.savePlay(b);BHP.deal.resetAll()},loadSavedPlaysList:function(){for(var a=$("#lines"),b=BHP.deal.getSavedPlaysList(),c=0;c<b.length;++c){var d=
'<li><a class="btn saved-play">'+unescape(b[c])+"</a></li>";a.append(d)}$(".saved-play").click(function(){BHP.loadSavedPlay(this)})},loadSavedPlay:function(a){if(BHP.deal.hasUnsavedPlay())BHP.showModalConfirmDialog("Load Play Confirm","You have made some plays that have not been saved. If you load another play you will losed the current unsave play. Do you want to Load another play? ",function(){var b=$(a).html();BHP.rewind();BHP.deal.loadPlay(b);BHP.hideModalConfirmDialog()});else{var b=$(a).html();
BHP.rewind();BHP.deal.loadPlay(b)}},loadPlay:function(){var a=null;try{for(var b in BHP.queryParameters)if(BHP.queryParameters.hasOwnProperty(b)&&"p"===b.charAt(0).toLowerCase()){var c=b.substr(1);c||(c="Default");null===a&&(a=c);var d=BHP.queryParameters[b],c=unescape(c);BHP.loadPlayByName(d,c)}null!==a&&(a=unescape(a),BHP.deal.loadPlay(a))}catch(e){BHP.addError(e)}},createURLQueryParameters:function(a){void 0===a&&(a=!1);var b="",c=[],d="",e;for(e in Bridge.Directions)if(Bridge.Directions.hasOwnProperty(e)){var f=
BHP.deal.getHand(e),g=BHP.deal.getName(e);g&&(d+="&"+e+"n="+g);var g="",h;for(h in f.cards)if(f.cards.hasOwnProperty(h)){var k="",l;for(l in f.cards[h])f.cards[h].hasOwnProperty(l)&&(k+=l);k&&(g+=h+k)}g&&c.push(e+"="+g)}b+=c.join("&");b+=d;c=BHP.deal.getBoard();null!==c&&(b+="&b="+c);c=BHP.deal.getDealer();null!==c&&(b+="&d="+c);c=BHP.deal.getVulnerability();null!==c&&(b+="&v="+c);c=BHP.deal.getAuction();if(0===c.length)null!==BHP.contractString&&(b+="&a="+BHP.contractString);else for(b+="&a=",d=
0;d<c.length;++d)e=c[d],f=e.getSuit(),b="p"===f||"x"===f||"r"===f?b+f:b+(e.getLevel()+f),f=e.getAnnotation(),null!==f&&(b+="{"+f+"}"),e=e.getExplanation(),null!==e&&(b+="("+e+")");b+=BHP.deal.getPlayStrings(a);a&&(a=BHP.deal.getNotes(),null!==a&&(b+="&t="+a));return b},changeToPlay:function(a){if(!BHP.deal.isValidPlayNumber(a))return!1;var b=BHP.deal.getPlayNumber();if(a<b)for(;!BHP.deal.isAtBeginning()&&!BHP.deal.isAtPlayNumber(a);)BHP.undoCard();else if(a>b)for(;!BHP.deal.isAtEnd()&&!BHP.deal.isAtPlayNumber(a);)BHP.redoCard();
return!0},processHash:function(){if(!BHP.manualHashChange){var a=location.hash.substring(1),a=a?parseInt(a):0;return BHP.changeToPlay(a)}BHP.manualHashChange=!1},setHash:function(){BHP.manualHashChange=!0;window.location.hash=BHP.deal.getPlayNumber()}};BHP.HA.shownHand="n";
BHP.HA.drawHandAssignment=function(){BHP.viewport={width:$(window).width(),height:$(window).height()};var a;$("#section").empty();var b=$("#header").outerHeight();BHP.HA.drawFooter();var c=(BHP.viewport.width-3*BHP.gutter)/2;a="#section";var d="card-pile-title",e='<span id="'+d+'"  class="text-size fixed label label-'+BHP.getOption("bootstrapClass")+'">Unassigned Cards</span>';$(a).append(e);e=$("#"+d);e.css({top:b+BHP.gutter,left:BHP.gutter});var f=e.outerHeight(),d="assigned-cards-title",e='<span id="'+
d+'"  class="text-size fixed label label-'+BHP.getOption("bootstrapClass")+'">Assigned Cards</span>';$(a).append(e);e=$("#"+d);e.css({top:b+BHP.gutter,left:c+2*BHP.gutter});var e=e.outerHeight(),f=Math.max(f,e),g=BHP.footer.position().top-b-f,e='<div id="card-pile" class="well fixed"></div>';$(a).append(e);d=$("#card-pile");g-=2*BHP.gutter;d.css({top:f+b+BHP.gutter,left:BHP.gutter,width:c,height:g});e='<div id="assigned-cards" class="well fixed"></div>';$(a).append(e);d=$("#assigned-cards");d.css({top:f+
b+BHP.gutter,left:c+2*BHP.gutter,width:c,height:g});a=null;var e='<div class="panel-group" id="assigned-hands">',h;for(h in Bridge.Directions)if(Bridge.Directions.hasOwnProperty(h)){b=h+"-assigned-cards";a=h+"-assigned-cards-body";var g=h+"-name",k;h===BHP.HA.shownHand?(f="in",k="panel panel-"+BHP.getOption("bootstrapClass")):(f="",k="panel panel-default");e+='<div class="'+k+'">';e+='<div class="panel-heading">';e+='<h4 class="panel-title">';e+='<a id="'+g+'" direction="'+h+'" class="hand-switcher" data-toggle="collapse" data-parent="#assigned-hands" href="#'+
b+'">';g=BHP.deal.getName(h);null===g&&(g=Bridge.getDirectionName(h));e+=g+'</a> <span id="'+b+'-count" class="label label-primary">0</span> (<a class="change-name" direction="'+h+'" href="javascript:void(0);">Change Name</a>)';e+="</h4>";e+="</div>";e+='<div direction="'+h+'" id="'+b+'" class="panel-collapse collapse '+f+'">';e+='<div id="'+a+'" class="panel-body">';e+="";e+="</div>";e+="</div>";e+="</div>"}e+="</div>";d.empty().append(e);for(var l in Bridge.Directions)Bridge.Directions.hasOwnProperty(l)&&
(a=l+"-assigned-cards-body",$("#"+a).height(d.outerHeight()/2));$(".hand-switcher").click(function(){if($(this).attr("direction")===BHP.HA.shownHand)return!1});$(".panel-collapse").on("shown.bs.collapse",function(){BHP.HA.shownHand=$(this).attr("direction");$(this).parent().removeClass("panel-default").addClass("panel-"+BHP.getOption("bootstrapClass"));BHP.HA.drawAssignedCards(BHP.HA.shownHand)});$(".panel-collapse").on("hide.bs.collapse",function(){$(this).parent().addClass("panel-default").removeClass("panel-"+
BHP.getOption("bootstrapClass"))});$(".change-name").click(function(){var a=$(this).attr("direction");BHP.changeNameDialog(a)});$(".change-name").attr("title","Click to change Name").tooltip();$(".hand-switcher").attr("title","Click make this the Active Hand").tooltip();BHP.HA.computeScalingFactor(c);BHP.HA.drawUnassignedCards();BHP.HA.updateHandCount();BHP.HA.drawAssignedCards(BHP.HA.shownHand)};
BHP.changeNameDialog=function(a){var b="Change Name for "+Bridge.getDirectionName(a)+" player",c=a+"-name",d=BHP.deal.getName(a);null===d&&(d=Bridge.getDirectionName(a));$("#modal-popup-save-content").val(d).attr("direction",a);BHP.showModalSaveDialog(b,BHP.saveName);$("#"+c).html(d)};BHP.saveName=function(){var a=$("#modal-popup-save-content").attr("direction"),b=$("#modal-popup-save-content").val(),c=a+"-name";BHP.deal.setName(b,a);$("#"+c).html(b);BHP.hideModalSaveDialog()};
BHP.HA.drawUnassignedCards=function(){for(var a=$("#card-pile"),b=a.position().top+5,c=BHP.cardImageDimensions.width*BHP.HA.scalingFactor,d=BHP.cardImageDimensions.height*BHP.HA.scalingFactor,e=0;e<Bridge.CardSuitOrder.length;++e){var f=Bridge.CardSuitOrder[e];0!==e&&(b+=BHP.cardImageDimensions.height*BHP.cardImageDimensions.percentageHeightShowing*BHP.HA.scalingFactor);for(var g=a.position().left+5,h=0;h<Bridge.RankOrder.length;++h){var k=Bridge.RankOrder[h];0!==h&&(g+=BHP.cardImageDimensions.width*
BHP.cardImageDimensions.percentageWidthShowing*BHP.HA.scalingFactor);BHP.HA.showUnassignedCard(a,f,k,b,g,c,d)}}BHP.HA.updateUnassignedCardStatus()};BHP.HA.unAssignedCardClick=function(a){var b=$(a).attr("suit"),c=$(a).attr("rank");BHP.deal.addCard(b,c,BHP.HA.shownHand);$(a).attr("src",BHP.cardImageDimensions.cardBackImage);$(a).unbind("click");$(a).addClass("cursor-not-allowed");$(a).tooltip("destroy");BHP.HA.drawAssignedCards(BHP.HA.shownHand);BHP.HA.updateButtonStatus()};
BHP.HA.updateButtonStatus=function(){var a=BHP.HA.isValid();$("#check-hands").attr("disabled",!a);$("#assign-randomly").attr("disabled",a)};BHP.HA.getAssignedCardID=function(a,b){return"assigned-"+a+b};BHP.HA.getUnassignedCardID=function(a,b){return"unassigned-"+a+b};
BHP.HA.drawVertical=function(a){var b=BHP.deal.getHand(a),c=$("#assigned-cards"),d=$("#"+(a+"-assigned-cards-body"));d.empty();for(var e=c.position().top+d.position().top+BHP.gutter,f=0,g=BHP.cardImageDimensions.width*BHP.HA.assignedCardLayout.scalingFactor,h=BHP.cardImageDimensions.height*BHP.HA.assignedCardLayout.scalingFactor,k=c=c.position().left+d.position().left+BHP.gutter,l=0;l<Bridge.CardSuitOrder.length;++l){var m=Bridge.CardSuitOrder[l],k=c;0!==l&&(e+=BHP.cardImageDimensions.height*BHP.cardImageDimensions.percentageHeightShowing*
BHP.HA.assignedCardLayout.scalingFactor);for(var n=0;n<Bridge.RankOrder.length;++n){var p=Bridge.RankOrder[n];if(p in b.cards[m]){var q=BHP.HA.getAssignedCardID(m,p);$("#"+q).remove();BHP.HA.showCard(d,m,p,e,k,g,h,q,"assigned-card");k+=BHP.cardImageDimensions.width*BHP.cardImageDimensions.percentageWidthShowing*BHP.HA.assignedCardLayout.scalingFactor;f++}}}$("#"+(a+"-assigned-cards-count")).html(f)};
BHP.HA.drawHorizontal=function(a){var b=BHP.deal.getHand(a),c=$("#assigned-cards"),d=$("#"+(a+"-assigned-cards-body"));d.empty();for(var e=c.position().top+d.position().top+BHP.gutter,f=0,g=BHP.cardImageDimensions.width*BHP.HA.assignedCardLayout.scalingFactor,h=BHP.cardImageDimensions.height*BHP.HA.assignedCardLayout.scalingFactor,c=c.position().left+d.position().left+BHP.gutter,k=BHP.getOption("alternateSuitColor")?BHP.deal.getSuitOrder(a):Bridge.CardSuitOrder,l=0;l<k.length;++l)for(var m=k[l],n=
0;n<Bridge.RankOrder.length;++n){var p=Bridge.RankOrder[n];if(p in b.cards[m]){var q=BHP.HA.getAssignedCardID(m,p);$("#"+q).remove();BHP.HA.showCard(d,m,p,e,c,g,h,q,"assigned-card");c+=BHP.cardImageDimensions.width*BHP.cardImageDimensions.percentageWidthShowing*BHP.HA.assignedCardLayout.scalingFactor;f++}}$("#"+(a+"-assigned-cards-count")).html(f)};
BHP.HA.drawAssignedCards=function(a){"vertical"===BHP.HA.assignedCardLayout.type?BHP.HA.drawVertical(a):BHP.HA.drawHorizontal(a);$(".assigned-card").tooltip().click(function(){var a=$(this).attr("suit"),c=$(this).attr("rank");BHP.deal.removeCard(a,c,BHP.HA.shownHand);a=BHP.HA.getUnassignedCardID(a,c);a=$("#"+a);a.attr("src",a.attr("imageName"));a.removeClass("cursor-not-allowed");a.tooltip();a.unbind("click");a.click(function(){BHP.HA.unAssignedCardClick(this)});BHP.HA.drawAssignedCards(BHP.HA.shownHand);
BHP.HA.updateButtonStatus()})};BHP.HA.isValid=function(){for(var a in Bridge.Directions)if(13!==BHP.deal.getNumCards(a))return!1;return!0};
BHP.HA.updateUnassignedCardStatus=function(){for(var a=0;a<Bridge.CardSuitOrder.length;++a)for(var b=Bridge.CardSuitOrder[a],c=0;c<Bridge.RankOrder.length;++c){var d=Bridge.RankOrder[c],e=BHP.HA.getUnassignedCardID(b,d),e=$("#"+e),f=(d=Bridge.Cards.isAssigned(b,d))?"assigned":"unassigned",g=d?"cursor-not-allowed":"",h=d?BHP.cardImageDimensions.cardBackImage:e.attr("imageName");e.unbind("click");d?e.tooltip("destroy"):(e.tooltip(),e.click(function(){BHP.HA.unAssignedCardClick(this)}));e.attr("status",
f);e.attr("src",h);e.removeClass("cursor-not-allowed").addClass(g)}};
BHP.HA.showUnassignedCard=function(a,b,c,d,e,f,g){var h=BHP.HA.getUnassignedCardID(b,c),k=Bridge.Cards.isAssigned(b,c),l=BHP.cardImageDimensions.folder+"/"+b+c+".png",m=k?"assigned":"unassigned",n=k?"cursor-not-allowed":"",p=k?BHP.cardImageDimensions.cardBackImage:l;$(a).append('<img id="'+h+'" class="fixed unassigned-card '+n+'"></img>');a=$("#"+h);a.attr("src",p);a.attr("imageName",l);a.attr("status",m);a.attr("suit",b);a.attr("rank",c);a.css({width:f,height:g,top:d,left:e});k||a.attr("title","Click to Assign to Active Hand").tooltip()};
BHP.HA.showCard=function(a,b,c,d,e,f,g,h,k){var l=BHP.cardImageDimensions.folder+"/"+b+c+".png";$(a).append('<img id="'+h+'" class="fixed '+k+'"></img>');a=$("#"+h);a.attr("src",l);a.attr("imageName",l);a.attr("status","unassigned");a.attr("suit",b);a.attr("rank",c);a.attr("title","Click to Unassign Card");a.css({width:f,height:g,top:d,left:e})};
BHP.HA.computeScalingFactor=function(a){var b=$("#assigned-cards"),c=3*BHP.cardImageDimensions.height*BHP.cardImageDimensions.percentageHeightShowing+BHP.cardImageDimensions.height;a=(a-2*BHP.gutter)/(12*BHP.cardImageDimensions.width*BHP.cardImageDimensions.percentageWidthShowing+BHP.cardImageDimensions.width);b=(b.outerHeight()/2-2*BHP.gutter)/c;BHP.HA.scalingFactor=Math.min(a,b);BHP.HA.assignedCardLayout=BHP.computeScalingFactorForAllHands("#"+BHP.HA.shownHand+"-assigned-cards")};
BHP.setModalTitle=function(a,b){void 0===b&&(b=!1);$("#modal-popup"+(b?"-save":"")+"-title").html(a)};BHP.setModalContent=function(a,b){void 0===b&&(b=!1);$("#modal-popup"+(b?"-save":"")+"-content").html(a)};BHP.showModal=function(a){$("#modal-dialog-content").html(a);$("#modal-dialog").modal("show")};BHP.hideModal=function(){$("#modal-dialog").modal("hide")};BHP.showModalDialog=function(a,b){BHP.setModalTitle(a,!1);BHP.setModalContent(b,!1);$("#modal-popup").modal("show")};BHP.hideModalDialog=function(){$("#modal-popup").modal("hide")};
BHP.showModalConfirmDialog=function(a,b,c,d){$("#modal-popup-confirm-title").html(a);$("#modal-popup-confirm-content").html(b);"vulnerability"===d&&$(".change-vulnerability").click(function(){$("#modal-popup-confirm-content").attr("vulnerability",$(this).attr("vulnerability"));$(".change-vulnerability").removeClass("btn-"+BHP.getOption("bootstrapClass")).addClass("btn-default");$(this).addClass("btn-"+BHP.getOption("bootstrapClass"))});$("#modal-popup-confirm-ok").unbind("click");$("#modal-popup-confirm-ok").click(c);
$("#modal-popup-confirm").modal("show")};BHP.hideModalConfirmDialog=function(){$("#modal-popup-confirm").modal("hide")};BHP.showModalSaveDialog=function(a,b){BHP.setModalTitle(a,!0);$("#modal-popup-save-ok").unbind("click");$("#modal-popup-save-ok").click(b);$("#modal-popup-save").modal("show")};BHP.hideModalSaveDialog=function(){$("#modal-popup-save").modal("hide")};BHP.hideAllModals=function(){BHP.hideModal();BHP.hideModalDialog();BHP.hideModalConfirmDialog();BHP.hideModalSaveDialog()};
BHP.showContactInformation=function(){BHP.showModalDialog("Contact Information",'<h4>Send email to <span style="unicode-bidi:bidi-override; direction: rtl;">moc.liamg@egdirbnaidni</span></h4>')};
BHP.showOptions=function(){var a;a='<table class="table table-condensed table-striped"><thead><tr><th>Option Name</th><th>Option Value</th></tr></thead><tbody>';for(var b in BHP.OptionSet){var c=BHP.OptionSet[b];a+="<tr><td>";a+=c.label;a+="</td><td>";switch(c.type.toLowerCase()){case "checkbox":a+='<input id="'+c.id+'" type="checkbox" '+(c.value?"checked":"")+">";break;case "select":a+='<select id="'+c.id+'" class="form-control">';for(var d=0;d<c.values.length;++d)a+="<option "+(c.values[d].value===
c.value?"selected":"")+' value="'+c.values[d].value+'">'+c.values[d].name+"</option>";a+="</select>"}a+="</td>"}a+="</tbody></table>";$("#modal-popup-options-body").empty().append(a);$("#modal-popup-options").modal("show")};BHP.getOption=function(a){return a in BHP.OptionSet?BHP.OptionSet[a].value:null};
BHP.processOptions=function(){var a=!1,b=null,c;for(c in BHP.OptionSet){var d=BHP.OptionSet[c],e=$("#"+d.id);switch(d.type.toLowerCase()){case "checkbox":b=e.is(":checked");break;case "select":b=e.val()}d.value!==b&&(d.value=b,a=!0)}$("#modal-popup-options").modal("hide");a&&BHP.resizeHandler()};
BHP.PA.showInstructions=function(){var a;a='<ul class="list-group"><li class="list-group-item list-group-item-success">If a play has been specified in the URL then you can use the undo and redo play control buttons (bottom) to step through the plays. You can also add a #n to the end of the URL where n is the numeric index of the play you want to move to.</li>';a+='<li class="list-group-item ">At any point while following the play or if no play has been specified you can start creating your own line of play by clicking on cards. Playable cards will be highlighted in green outline.</li>';
a+='<li class="list-group-item list-group-item-success">Clicking on a played card ( cards shown on the table ) lets you enter a play annotation.</li>';a+='<li class="list-group-item ">You can also add an explanation to the auction by clicking on any bid.</li>';a+='<li class="list-group-item list-group-item-success">Plays can be saved and loaded using the Save play and Load play buttons (bottom)</li>';a+='<li class="list-group-item ">You can go back and edit the hands or the auction using the Edit Hands and Edit Auction buttons (bottom)</li>';
a+='<li class="list-group-item list-group-item-success">Click on player names to change the names, click on Board to change the board number, click on compass to change the vulnerability.</li>';a+='<li class="list-group-item ">At any point you can use the Generate URL (top) button to generate BBO or BW or BHP url/embed code that would include all of the currently saved information. Note that for BBO and BW only the currently active play will be included.</li>';a+="</ul>";BHP.showModalDialog('Play Area Instructions ( <a target="_blank" href="instructions.html">Click here for detailed instrutions in new page</a> )',
a)};
BHP.HA.showInstructions=function(){var a;a='<ul class="list-group"><li class="list-group-item list-group-item-success">The left pane contains unassigned cards. Assigned cards will be face down while unassigned cards will be face up. </li>';a+='<li class="list-group-item ">The right pane shows the currently active hand. Click on another hand to make that active.</li>';a+='<li class="list-group-item list-group-item-success">Click on unassigned cards in the left pane to assign it to the currently active hand.</li>';a+=
'<li class="list-group-item ">Click on any card in left pane to remove it from the active hand and add it to the unassigned cards.</li>';a+='<li class="list-group-item list-group-item-success">Click Assign Rest Automatically to assign the remaining unassigned cards to hands with space available. This will randomly assign the remaining unassigned cards. This can also be used to assign the fourth hand when three have been specified.</li>';a+='<li class="list-group-item ">Click Redeal Random Hand to create a different hand. This is essentially a shortcut to clicking Unassign and then Assign Rest Automatically.</li>';
a+='<li class="list-group-item list-group-item-success">Click Unassign All Cards to move all assigned cards to unassigned status and start fresh.</li>';a+='<li class="list-group-item ">When the hands form a valid deal (13 cards each) the Accept Hands button will be enabled and can be clicked to go to the next area.</li>';a+='<li class="list-group-item list-group-item-success">At any point you can use the Generate URL (top) button to generate BBO or BW or BHP url/embed code that would include all of the currently saved information</li>';
a+="</ul>";BHP.showModalDialog('Create Hands Instructions ( <a target="_blank" href="instructions.html">Click here for detailed instrutions in new page</a> )',a)};BHP.HA.selectHands=function(){$("#show-instructions").unbind("click");$("#show-instructions").click(BHP.HA.showInstructions);$("#header-title").html("Set Hands");BHP.HA.drawHandAssignment()};BHP.HA.updateHandCount=function(){for(var a in Bridge.Directions)if(a!==BHP.HA.shownHand){var b=BHP.deal.getNumCards(a);$("#"+(a+"-assigned-cards-count")).html(b)}BHP.HA.updateButtonStatus()};
BHP.HA.drawFooter=function(){$("#footer-menu-bar").remove();var a='<div id="footer-menu-bar" class="fixed btn-toolbar" role="toolbar"></div>';$("body").append(a);BHP.footer=$("#footer-menu-bar");a={"assign-randomly":{name:"Assign Rest Automatically",icon:"transfer",iconAfter:!1},redeal:{name:"Redeal Random Hand",icon:"refresh",iconAfter:!1},"unassign-all":{name:"Unassign All Cards (Reset)",icon:"remove",iconAfter:!1}};a=BHP.getButtonGroupHTML("utility-function2",a);BHP.footer.append(a);a={"check-hands":{name:"Accept Hands",
icon:"ok",iconAfter:!1}};a=BHP.getButtonGroupHTML("accept-hands",a);BHP.footer.append(a);BHP.HA.updateButtonStatus();a=BHP.viewport.width/2-BHP.footer.width()/2;BHP.footer.css({left:a,bottom:0});$("#assign-randomly").click(function(){BHP.deal.assignRest();BHP.HA.updateUnassignedCardStatus();BHP.HA.drawAssignedCards(BHP.HA.shownHand);BHP.HA.updateHandCount()});$("#redeal").click(function(){BHP.showModalConfirmDialog("Redeal Cards Confirm","Are you sure that you want to redeal cards? This will also delete the auction and all plays.",
BHP.HA.redealCards)});$("#unassign-all").click(function(){BHP.showModalConfirmDialog("Unassign All Cards Confirm","Are you sure that you want to unassign all cards? This will also delete the auction and all plays.",BHP.HA.unassignAllCards)});$("#check-hands").click(function(){$(this).tooltip("hide");BHP.handleAuction()});$(".toolbar").tooltip({placement:"top",container:"body"})};
BHP.HA.redealCards=function(){BHP.deal.unAssignAll();BHP.deal.assignRest();BHP.HA.updateUnassignedCardStatus();BHP.HA.drawAssignedCards(BHP.HA.shownHand);BHP.HA.updateHandCount();BHP.deal.undoAllBids();BHP.deal.deletePlays();BHP.hideModalConfirmDialog()};BHP.HA.unassignAllCards=function(){BHP.deal.unAssignAll();BHP.HA.updateUnassignedCardStatus();BHP.HA.drawAssignedCards(BHP.HA.shownHand);BHP.HA.updateHandCount();BHP.deal.undoAllBids();BHP.deal.deletePlays();BHP.hideModalConfirmDialog()};
BHP.computeScalingFactorForAllHands=function(a){var b=BHP.deal.getLongestSuit(),c=$(a).outerWidth()-2*BHP.gutter;a=$(a).outerHeight()-2*BHP.gutter;b=Math.min(a/(3*BHP.cardImageDimensions.height*BHP.cardImageDimensions.percentageHeightShowing+BHP.cardImageDimensions.height),c/((b-1)*BHP.cardImageDimensions.width*BHP.cardImageDimensions.percentageWidthShowing+BHP.cardImageDimensions.width));c=Math.min(a/BHP.cardImageDimensions.height,c/(12*BHP.cardImageDimensions.width*BHP.cardImageDimensions.percentageWidthShowing+
BHP.cardImageDimensions.width));a={scalingFactor:1,type:"vertical"};c>b?(a.scalingFactor=c,a.type="horizontal"):(a.scalingFactor=b,a.type="vertical");return a};BHP.AA.computeScalingFactor=function(a,b){BHP.AA.scalingFactor=Math.min(a/600,b/600);BHP.AA.buttonSize=1.5<BHP.AA.scalingFactor?"lg":1<BHP.AA.scalingFactor?"":0.5<BHP.AA.scalingFactor?"sm":"xs";var c=BHP.computeScalingFactorForAllHands("#current-hand");BHP.AA.scalingFactor=c.scalingFactor;BHP.AA.handLayout=c.type};
BHP.AA.drawVertical=function(a){var b=$("#current-hand");a=BHP.deal.getHand(a);for(var c=b.position().top+BHP.gutter,d=BHP.cardImageDimensions.width*BHP.AA.scalingFactor,e=BHP.cardImageDimensions.height*BHP.AA.scalingFactor,f=b.position().left+BHP.gutter,g=f,h=0;h<Bridge.CardSuitOrder.length;++h){var k=Bridge.CardSuitOrder[h],g=f;0!==h&&(c+=BHP.cardImageDimensions.height*BHP.cardImageDimensions.percentageHeightShowing*BHP.AA.scalingFactor);for(var l=0;l<Bridge.RankOrder.length;++l){var m=Bridge.RankOrder[l];
if(m in a.cards[k]){var n=BHP.HA.getAssignedCardID(k,m);$("#"+n).remove();BHP.HA.showCard(b,k,m,c,g,d,e,n,"assigned-card");g+=BHP.cardImageDimensions.width*BHP.cardImageDimensions.percentageWidthShowing*BHP.AA.scalingFactor}}}};
BHP.AA.drawHorizontal=function(a){var b=$("#current-hand"),c=BHP.deal.getHand(a),d=b.position().top+BHP.gutter,e=BHP.cardImageDimensions.width*BHP.AA.scalingFactor,f=BHP.cardImageDimensions.height*BHP.AA.scalingFactor,g=b.position().left+BHP.gutter;a=BHP.getOption("alternateSuitColor")?BHP.deal.getSuitOrder(a):Bridge.CardSuitOrder;for(var h=0;h<a.length;++h)for(var k=a[h],l=0;l<Bridge.RankOrder.length;++l){var m=Bridge.RankOrder[l];if(m in c.cards[k]){var n=BHP.HA.getAssignedCardID(k,m);$("#"+n).remove();
BHP.HA.showCard(b,k,m,d,g,e,f,n,"assigned-card");g+=BHP.cardImageDimensions.width*BHP.cardImageDimensions.percentageWidthShowing*BHP.AA.scalingFactor}}};BHP.AA.drawAssignedCards=function(a){$("#current-hand").empty();if(void 0!==a){"vertical"===BHP.AA.handLayout?BHP.AA.drawVertical(a):BHP.AA.drawHorizontal(a);var b=BHP.deal.getName(a);null===b&&(b=Bridge.getDirectionName(a));$("#current-hand-name").html(b)}};
BHP.AA.drawAuctionAssignment=function(){BHP.viewport={width:$(window).width(),height:$(window).height()};var a;$("#section").empty();var b=$("#header").outerHeight();BHP.AA.drawFooter();var c=(BHP.viewport.width-3*BHP.gutter)/2;a="#section";var d,e="bidding-box-title",f='<span id="'+e+'" class="text-size fixed label label-'+BHP.getOption("bootstrapClass")+'">Bidding Box</span>';$(a).append(f);f=$("#"+e);f.css({top:b+BHP.gutter,left:BHP.gutter});var g=f.outerHeight(),e="auction-title",f='<span id="'+
e+'" class="text-size fixed label label-'+BHP.getOption("bootstrapClass")+'">Auction So Far</span>';$(a).append(f);f=$("#"+e);f.css({top:b+BHP.gutter,left:c+2*BHP.gutter});var h=f.outerHeight(),g=Math.max(g,h),h=BHP.footer.position().top-b-g;d="bidding-box";f='<div id="'+d+'" class="well fixed status"></div>';$(a).append(f);f=$("#"+d);h-=2*BHP.gutter;f.css({top:g+b+BHP.gutter,left:BHP.gutter,width:c,height:h});e="current-hand-title";f='<span id="'+e+'" class="text-size fixed label label-'+BHP.getOption("bootstrapClass")+
'">Current Hand (<span id="current-hand-name"></span>)</span>';$(a).append(f);var f=$("#"+e),e=f.outerHeight(),k=h-BHP.gutter-e,l=b+BHP.gutter+g+k/2+BHP.gutter;f.css({top:l,left:c+2*BHP.gutter});d="auction";f='<div id="'+d+'" class="well fixed status"></div>';$(a).append(f);f=$("#"+d);f.css({top:g+b+BHP.gutter,left:c+2*BHP.gutter,width:c,height:k/2});d="current-hand";f='<div id="'+d+'" class="well fixed status"></div>';$(a).append(f);f=$("#"+d);f.css({top:l+e,left:c+2*BHP.gutter,width:c,height:k/
2});a="#bidding-box";$(a).empty();BHP.AA.computeScalingFactor(h,c);BHP.AA.showDealInformation(a);BHP.AA.createBiddingBox(a);BHP.drawAuction("#auction");BHP.AA.setBiddingBoxStatus()};
BHP.AA.showDealInformation=function(a){var b,c={n:"hand-up",s:"hand-down",e:"hand-right",w:"hand-left"};b='<table id="deal-information-table" class="table table-condensed"><tbody><tr><td>Dealer</td><td>'+('<div id="dealer" class="btn-group btn-group-'+BHP.AA.buttonSize+'">');var d=BHP.deal.getDealer(),e;for(e in Bridge.Directions)if(Bridge.Directions.hasOwnProperty(e)){var f=e+"-dealer-button",g="btn-default";d===e&&(g="btn-"+BHP.getOption("bootstrapClass"));b+='<button type="button" id="'+f+'" direction="'+
e+'" class="text-size change-dealer btn '+g+'">';b+='<span class="glyphicon glyphicon-'+c[e]+'"></span>';b+=Bridge.getDirectionName(e);b+="</button>"}b+="</div>";b+="</td><tr><tbody></table>";$(a).append(b);$("#deal-information-table").css({width:"auto"});$(".change-dealer").click(function(){var a=$(this).attr("direction");BHP.deal.hasBids()?($("#modal-popup-confirm-ok").attr("direction",a),BHP.showModalConfirmDialog("Change Dealer Confirm","If you change the dealer the existing auction will be wiped out! Are you sure you want to change the dealer?",
BHP.AA.setDealer)):BHP.deal.setDealer(a);BHP.AA.updateDealer()})};BHP.AA.setDealer=function(){var a=$(this).attr("direction");BHP.deal.setDealer(a);BHP.AA.updateDealer();BHP.hideModalConfirmDialog()};
BHP.AA.updateDealer=function(){var a=BHP.deal.getDealer(),b;for(b in Bridge.Directions)if(Bridge.Directions.hasOwnProperty(b)){var c=$("#"+(b+"-dealer-button"));a===b?c.removeClass("btn-default").addClass("btn-"+BHP.getOption("bootstrapClass")).attr("disabled",!0):c.addClass("btn-default").removeClass("btn-"+BHP.getOption("bootstrapClass")).attr("disabled",!1)}BHP.drawAuction("#auction");BHP.AA.setBiddingBoxStatus()};
BHP.AA.setBiddingBoxStatus=function(){$("#undo-bid").attr("disabled",!BHP.deal.hasBids());if(BHP.deal.isAuctionValid())BHP.deal.determineDeclarer(),$(".bid").attr("disabled",!0).addClass("cursor-not-allowed").hide(),$("#check-auction").attr("disabled",!1),$("#all-pass").attr("disabled",!0),$("#double").attr("disabled",!0).hide(),$("#redouble").attr("disabled",!0).hide(),BHP.AA.drawAssignedCards();else{$(".bid").attr("disabled",!1).removeClass("cursor-not-allowed").show();$("#check-auction").attr("disabled",
!0);$("#all-pass").attr("disabled",!1);for(var a=BHP.deal.getCurrentLevels(),b=parseInt(a.level),a=Bridge.BidSuitOrder.indexOf(a.suit),c=1;7>=c;++c)for(var d=0,e=Bridge.BidSuitOrder.length-1;0<=e;--e){var f=5*(c-1)+d;d++;f=$("#bid-"+f);c<b||c===b&&a<=e?f.attr("disabled",!0).addClass("cursor-not-allowed").hide():f.attr("disabled",!1).removeClass("cursor-not-allowed").show()}BHP.deal.isDoubleAllowed()?$("#double").attr("disabled",!1).show():$("#double").attr("disabled",!0).hide();BHP.deal.isRedoubleAllowed()?
$("#redouble").attr("disabled",!1).show():$("#redouble").attr("disabled",!0).hide();b=BHP.deal.getCurrentBiddingTurn();BHP.AA.drawAssignedCards(b)}};
BHP.AA.createBiddingBox=function(a){for(var b='<table id="bidding-box-table" class="table table-condensed"><tbody>',c=1;7>=c;++c){for(var b=b+"<tr>",d=0,e=Bridge.BidSuitOrder.length-1;0<=e;--e){var f=Bridge.BidSuitOrder[e],g=5*(c-1)+d;d++;b+='<td><button id="bid-'+g+'" bid="'+(""+c+f)+'" type="button" class="btn btn-'+BHP.AA.buttonSize+' btn-default bid">'+c+Bridge.getSuitName(f)+"</button></td>"}b+="</tr>"}b+='<tr><td colspan="5"><button id="pass" bid="1p" style="width:100%;" type="button" class="btn btn-success btn-'+
BHP.AA.buttonSize+' bid">Pass</button></td></tr>';b+='<tr><td colspan="5"><button id="double" bid="1x" style="width:100%;" type="button" class="btn btn-danger btn-'+BHP.AA.buttonSize+' bid">Double</button></td></tr>';b+='<tr><td colspan="5"><button id="redouble" bid="1r" style="width:100%;" type="button" class="btn btn-info btn-'+BHP.AA.buttonSize+' bid">Redouble</button></td></tr>';b+='<tr><td colspan="5"><button id="undo-bid" style="width:100%;" type="button" class="btn btn-warning btn-'+BHP.AA.buttonSize+
'">Undo Last Bid</button></td></tr>';$(a).append(b);$("#bidding-box-table").css({width:"auto"});$(".bid").click(function(){var a=$(this).attr("bid"),b=a.charAt(0),a=a.charAt(1);BHP.deal.addBid(b,a);BHP.drawAuction("#auction");BHP.AA.setBiddingBoxStatus()});$("#undo-bid").click(function(){BHP.deal.undoLastBid();BHP.drawAuction("#auction");BHP.AA.setBiddingBoxStatus()});$("#undo-bid").attr("title","Click to remove last bid").tooltip()};
BHP.AA.showInstructions=function(){var a;a='<ul class="list-group"><li class="list-group-item list-group-item-success">The left pane contains the dealer and the bidding box. Bids that are not valid in the current context will be hidden.</li>';a+='<li class="list-group-item ">The right pane contains the auction so far.</li>';a+='<li class="list-group-item list-group-item-success">Click on the directions next to Dealer to change the dealer. Note that if you have a developing auction then the entire auction will be wiped out ( you will be asked to confirm change of dealer if an auction exists )</li>';
a+='<li class="list-group-item ">Click on any bid in the bidding box to add it to the current position in the auction.</li>';a+='<li class="list-group-item list-group-item-success">Click on Undo Last Bid to remove the last bud in the auction.</li>';a+='<li class="list-group-item ">Click on any bid in the auction (right pane) to add an explanation/description.</li>';a+='<li class="list-group-item list-group-item-success">Click on Edit Hands button (bottom) to go back to editting hands. The current auction will be stored to be restored when you return to the auction area.</li>';
a+='<li class="list-group-item ">Click on Add All Pass button (bottom) to automatically fill in passes to complete the auction.</li>';a+='<li class="list-group-item list-group-item-success">Click on Undo All Bids button (bottom) to clear out all bids and start from scratch.</li>';a+='<li class="list-group-item ">When a valid auction has been created ( ending in 3 passes ), the Accept Auction button (bottom) will be enabled and can be clicked to proceed to the next area</li>';a+='<li class="list-group-item list-group-item-success">At any point you can use the Generate URL (top) button to generate BBO or BW or BHP url/embed code that would include all of the currently saved information</li>';
a+="</ul>";BHP.showModalDialog('Create Auction Instructions ( <a target="_blank" href="instructions.html">Click here for detailed instrutions in new page</a> )',a)};BHP.AA.selectAuction=function(){$("#show-instructions").unbind("click");$("#show-instructions").click(BHP.AA.showInstructions);$("#header-title").html("Set Auction");BHP.AA.drawAuctionAssignment()};
BHP.getButtonGroupHTML=function(a,b){var c;c=""+('<div id="'+a+'" class="btn-group btn-group-sm">');for(var d in b)if(b.hasOwnProperty(d)){c+='<button title="'+b[d].name+'" type="button" id="'+d+'" class="toolbar btn btn-'+BHP.getOption("bootstrapClass")+'">';var e='<span class="glyphicon glyphicon-'+b[d].icon+'"></span>';b[d].iconAfter||(c+=e+" ");BHP.getOption("useIconsOnly")||(c+='<span class="text-highlight">'+b[d].name+"</span>");b[d].iconAfter&&(c+=" "+e);c+="</button>"}return c+"</div>"};
BHP.AA.drawFooter=function(){$("#footer-menu-bar").remove();var a='<div id="footer-menu-bar" class="fixed btn-toolbar" role="toolbar"></div>';$("body").append(a);BHP.footer=$("#footer-menu-bar");a={"edit-hands":{name:"Edit Hands",icon:"wrench",iconAfter:!1}};a=BHP.getButtonGroupHTML("edit-functions",a);BHP.footer.append(a);a={"all-pass":{name:"Add All Pass",icon:"plus",iconAfter:!1},"undo-all-bids":{name:"Undo All Bids",icon:"remove",iconAfter:!1}};a=BHP.getButtonGroupHTML("utility-functions",a);
BHP.footer.append(a);a={"check-auction":{name:"Accept Auction/Contract",icon:"ok",iconAfter:!1}};a=BHP.getButtonGroupHTML("accept-auction",a);BHP.footer.append(a);$("#check-auction").attr("disabled",!BHP.HA.isValid());a=BHP.viewport.width/2-BHP.footer.width()/2;BHP.footer.css({left:a,bottom:0});$("#edit-hands").click(function(){$(this).tooltip("hide");BHP.handleHands(!0)});$("#all-pass").click(function(){for(;3>BHP.deal.numPasses();)BHP.deal.addBid(0,"p");BHP.drawAuction("#auction");BHP.AA.setBiddingBoxStatus()});
$("#check-auction").click(function(){$(this).tooltip("hide");BHP.deal.determineDeclarer();BHP.handlePlay()});$("#undo-all-bids").click(function(){BHP.showModalConfirmDialog("Undo All Bids Confirm","Are you sure that you want to undo all bids? This will also delete all plays.",BHP.AA.undoAllBids)});$(".toolbar").tooltip({placement:"top",container:"body"})};BHP.AA.undoAllBids=function(){BHP.deal.undoAllBids();BHP.drawAuction("#auction");BHP.AA.setBiddingBoxStatus();BHP.deal.deletePlays();BHP.hideModalConfirmDialog()};
BHP.generateURL=function(){var a="true"===$(this).attr("all").toLowerCase(),a=BHP.createURLQueryParameters(a),b=$(this).attr("id"),c="",d="",e="";if("bbo_url"===b)c="Bridge Base Online HandViewer Link",e="http://www.bridgebase.com/tools/handviewer.html?"+a,d='<a target="_blank" href="'+e+'">Click this link to go to BBO Handviewer URL</a><br/>',d+="OR Copy following text and Paste as Browser URL : ",d+='<textarea rows="4" cols="50" autofocus readonly>'+e+"</textarea>";else if("bw_url"===b)c="Bridge Winners Embed Code",
d+="Copy following text and Paste when creating Bridge Winners Article : ",d+='<textarea rows="4" cols="50" autofocus readonly>'+("{handviewer "+a+"}")+"</textarea>";else if("bhp_url"===b)c="This Sites extended format Link",e="http://bridge-hand-player.appspot.com/?"+a,d='<a target="_blank" href="'+e+'">Click this link to go to Link URL</a><br/>',d+="OR Copy following text and Paste as Browser URL : ",d+='<textarea rows="4" cols="50" autofocus readonly>'+e+"</textarea>";else{alert("Invalid ID : "+
b);return}BHP.showModalDialog(c,d)};BHP.resizeHandler=function(){"set-hands"===BHP.state?BHP.HA.selectHands():"set-auction"===BHP.state?BHP.AA.selectAuction():"set-play"===BHP.state&&BHP.drawAll()};BHP.handlePlay=function(){BHP.state="set-play";BHP.drawAll()};BHP.handleHands=function(a){void 0===a&&(a=!1);BHP.deal.areHandsValid()||(a=!0);a?(BHP.state="set-hands",BHP.HA.selectHands()):BHP.handleAuction()};
BHP.handleAuction=function(a){void 0===a&&(a=!1);BHP.deal.isAuctionValid()||(a=!0);a?(BHP.state="set-auction",BHP.AA.selectAuction()):BHP.handlePlay()};
BHP.loadBootswatchThemes=function(){$.get("https://bootswatch.com/api/3.json",function(a){var b='<li><a class="theme-name" href="javascript:void(0);" id="default">Default</a></li>';BHP.bootswatchThemes["default"]={name:"Default",cssCdn:"https://netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css"};a=a.themes;for(var c=0;c<a.length;c++){var d=a[c].name.toLowerCase();BHP.bootswatchThemes[d]=a[c];b+='<li><a class="theme-name" href="javascript:void(0);" id="'+d+'">';b+='<img width="25" height="25" src="'+
a[c].thumbnail+'" alt="'+a[c].name+'"></img> '+a[c].name;b+="</a></li>"}$("#themes").html(b);$(".theme-name").click(function(){var a=$(this).attr("id");$.cookie("bootswatch_theme",JSON.stringify(BHP.bootswatchThemes[a]));BHP.loadStylesheet(BHP.bootswatchThemes[a].name,BHP.bootswatchThemes[a].cssCdn)})})};BHP.themeChanged=function(a){$("#current-theme").html(a);BHP.resizeHandler();BHP.hideModal()};
BHP.drawPage=function(a){$("#current-theme").html(a);BHP.deal.areHandsValid()?BHP.deal.isAuctionValid()?BHP.handlePlay():BHP.handleAuction():BHP.handleHands();BHP.hideModal()};
BHP.loadStylesheet=function(a,b){var c,d;if(void 0===a){c="Default";d="https://netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css";var e=$.cookie("bootswatch_theme");void 0!==e&&(d=JSON.parse(e),c=d.name,d=d.cssMin)}else c=a,d=b;void 0===d&&(c="Default",d="https://netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css");BHP.showModal("Loading "+c+" theme");$("#bootswatch-theme").remove();d='<link id="bootswatch-theme" href="'+d+'" rel="stylesheet">';$("head").append(d);$("#bootswatch-theme").on("load",
function(){void 0===a?BHP.drawPage(c):BHP.themeChanged(c)})};
$(function(){BHP.state="init";BHP.hideAllModals();$(".tooltip-bottom").tooltip({placement:"bottom",container:"body"});$(".generate-url").click(BHP.generateURL);$("#show-contact").click(BHP.showContactInformation);$("#show-options").click(BHP.showOptions);$("#modal-popup-options-ok").click(BHP.processOptions);BHP.deal=new Bridge.Deal;BHP.errors=[];$(window).resize(function(){BHP.resizeHandler()});BHP.readQueryParameters();BHP.queryParameters&&(BHP.loadNames(),BHP.loadHands(),BHP.loadDealInformation(),
BHP.loadAuction(),BHP.loadPlay());BHP.loadBootswatchThemes();BHP.loadStylesheet()});
